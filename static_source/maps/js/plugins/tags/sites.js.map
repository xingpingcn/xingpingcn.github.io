{"version":3,"sources":["js/plugins/tags/sites.js"],"names":["SitesJS","requestAPI","t","e","r","n","a","Promise","o","i","s","c","setTimeout","fetch","then","clearTimeout","ok","json","Error","layout","el","api","querySelector","remove","content","forEach","url","title","screenshot","avatar","description","innerHTML","innerText","start","document","getElementsByClassName","length","getAttribute","Object","volantis","GLOBAL_CONFIG","link","cover","addEventListener"],"mappings":"AAAA,aAAA,IAAMA,QAAU,CACdC,WAAY,SAACC,EAAKC,EAAUC,GAC1B,IAAIC,EAAa,GAEjB,SAASC,IACP,OAAO,IAAIC,SAAQ,SAACC,EAASC,GAC3B,IAAIC,EAAS,EACTC,EAAQC,YAAW,WACN,IAAXF,IACFA,EAAS,EACTC,EAAQ,KACRF,EAAO,QACW,GAAdJ,GACFD,IAGN,GAAG,KACHS,MAAMX,GAAKY,MAAK,SAAUZ,GAOxB,GANe,IAAXQ,IACFK,aAAaJ,GACbH,EAAQN,GACRS,EAAQ,KACRD,EAAS,GAEPR,EAASc,GACX,OAAOd,EAASe,OAElB,MAAM,IAAIC,MAAM,+BAClB,IAAGJ,MAAK,SAAUZ,GAChBG,EAAa,EACbF,EAASD,EACX,IAAE,UAAO,SAAUA,GACbG,EAAa,GACfA,GAAc,EACdO,YAAW,WACTN,GACF,GAAG,MAEHF,GAEJ,GACF,GACF,CAtCA,EAwCF,EACAe,OAAQ,SAACjB,GACP,IAAMC,EAAKD,EAAIkB,GACfpB,QAAQC,WAAWC,EAAImB,KAAK,SAAUjB,GACpCD,EAAGmB,cAAc,iBAAiBC,SAClC,IAAMlB,EAAMD,EAAKoB,QACblB,EAAU,GACdD,EAAIoB,SAAQ,SAACtB,EAAMC,GACjB,IAAIC,EAAO,0BACXA,GAAQ,iFAAmFF,EAAKuB,IAAM,KACtGrB,GAAQ,aAAeF,EAAKwB,MAAQ,WAAaxB,EAAKyB,YAAe,iDAAmDzB,EAAKuB,KAAQ,oCACrIrB,GAAQ,qBACRA,GAAQ,aAAeF,EAAKwB,MAAQ,WAAaxB,EAAK0B,QAAU3B,EAAI2B,QAAU,qCAC9ExB,GAAQ,uBAAyBF,EAAKwB,MAAQ,UAC9CtB,GAAQ,uBAAyBF,EAAK2B,aAAe3B,EAAKuB,KAAO,UACjErB,GAAQ,SACRA,GAAQ,OAERC,GADAD,GAAQ,QAEV,IACAF,EAAGmB,cAAc,eAAeS,UAAYzB,CAC9C,IAAG,WACD,IACEH,EAAGmB,cAAc,qBAAqBC,SACtCpB,EAAGmB,cAAc,mBAAmBU,UAAU,cAChD,CAAE,MAAO9B,GAAK,CAChB,GACF,EACA+B,MAAO,SAAC/B,GAEN,IADA,IAAMC,EAAM+B,SAASC,uBAAuB,gBACnC/B,EAAI,EAAGA,EAAID,EAAIiC,OAAQhC,IAAK,CACnC,IAAMC,EAAKF,EAAIC,GACTE,EAAMD,EAAGgC,aAAa,OACjB,MAAP/B,KAGAJ,EAAM,IAAIoC,QACX,SAASjC,EAAGgC,aAAa,SAC5BnC,EAAIkB,GAAKf,EACTH,EAAImB,IAAMf,EACVJ,EAAI2B,OAASU,SAASC,cAAa,WAASC,KAC5CvC,EAAI0B,WAAaW,SAASC,cAAa,WAASE,MAChD1C,QAAQmB,OAAOjB,GACjB,CACF,GAIFF,QAAQiC,QACRC,SAASS,iBAAiB,iBAAiB,WACzC3C,QAAQiC,OACV","file":"../../../../js/plugins/tags/sites.js","sourcesContent":["const SitesJS = {\n  requestAPI: (url, callback, timeout) => {\n    let retryTimes = 5;\n\n    function request() {\n      return new Promise((resolve, reject) => {\n        let status = 0; // 0 等待 1 完成 2 超时\n        let timer = setTimeout(() => {\n          if (status === 0) {\n            status = 2;\n            timer = null;\n            reject('请求超时');\n            if (retryTimes == 0) {\n              timeout();\n            }\n          }\n        }, 5000);\n        fetch(url).then(function (response) {\n          if (status !== 2) {\n            clearTimeout(timer);\n            resolve(response);\n            timer = null;\n            status = 1;\n          }\n          if (response.ok) {\n            return response.json();\n          }\n          throw new Error('Network response was not ok.');\n        }).then(function (data) {\n          retryTimes = 0;\n          callback(data);\n        }).catch(function (error) {\n          if (retryTimes > 0) {\n            retryTimes -= 1;\n            setTimeout(() => {\n              request();\n            }, 5000);\n          } else {\n            timeout();\n          }\n        });\n      });\n    }\n    request();\n  },\n  layout: (cfg) => {\n    const el = cfg.el;\n    SitesJS.requestAPI(cfg.api, function (data) {\n      el.querySelector('.loading-wrap').remove();\n      const arr = data.content;\n      var cellALL = \"\";\n      arr.forEach((item, i) => {\n        var cell = '<div class=\"site-card\">';\n        cell += '<a class=\"card-link\" target=\"_blank\" rel=\"external noopener noreferrer\" href=\"' + item.url + '\">';\n        cell += '<img alt=\"' + item.title + '\" src=\"' + (item.screenshot || ('https://image.thum.io/get/width/1024/crop/768/' + item.url)) + '\" onerror=\"errorImgCover(this)\"/>';\n        cell += '<div class=\"info\">';\n        cell += '<img alt=\"' + item.title + '\" src=\"' + (item.avatar || cfg.avatar) + '\" onerror=\"errorImgAvatar(this)\"/>';\n        cell += '<span class=\"title\">' + item.title + '</span>';\n        cell += '<span class=\"desc\">' + (item.description || item.url) + '</span>';\n        cell += '</div>';\n        cell += '</a>';\n        cell += '</div>';\n        cellALL += cell;\n      });\n      el.querySelector('.group-body').innerHTML = cellALL;\n    }, function () {\n      try {\n        el.querySelector('.loading-wrap svg').remove();\n        el.querySelector('.loading-wrap p').innerText('加载失败，请稍后重试。');\n      } catch (e) { }\n    });\n  },\n  start: (cfg) => {\n    const els = document.getElementsByClassName('sitesjs-wrap');\n    for (var i = 0; i < els.length; i++) {\n      const el = els[i];\n      const api = el.getAttribute('api');\n      if (api == null) {\n        continue;\n      }\n      var cfg = new Object();\n      cfg.class = el.getAttribute('class');\n      cfg.el = el;\n      cfg.api = api;\n      cfg.avatar = volantis.GLOBAL_CONFIG.default.link;\n      cfg.screenshot = volantis.GLOBAL_CONFIG.default.cover;\n      SitesJS.layout(cfg);\n    }\n  }\n}\n\n\nSitesJS.start();\ndocument.addEventListener('pjax:complete', function () {\n  SitesJS.start();\n});"]}