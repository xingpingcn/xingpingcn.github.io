<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>邢平cn&#39;s blog</title>
  
  
  <link href="https://xingpingcn.top/atom.xml" rel="self"/>
  
  <link href="https://xingpingcn.top/"/>
  <updated>2025-01-31T09:40:51.339Z</updated>
  <id>https://xingpingcn.top/</id>
  
  <author>
    <name>邢平cn</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>邓晓芒《黑格尔辩证法讲演录》读书笔记</title>
    <link href="https://xingpingcn.top/%E9%BB%91%E6%A0%BC%E5%B0%94%E8%BE%A9%E8%AF%81%E6%B3%95%E8%AE%B2%E6%BC%94%E5%BD%95.html"/>
    <id>https://xingpingcn.top/%E9%BB%91%E6%A0%BC%E5%B0%94%E8%BE%A9%E8%AF%81%E6%B3%95%E8%AE%B2%E6%BC%94%E5%BD%95.html</id>
    <published>2024-09-30T16:00:00.000Z</published>
    <updated>2025-01-31T09:40:51.339Z</updated>
    
    <content type="html"><![CDATA[<p>邓晓芒的这本书只能利用碎片时间去看了，目前只读了一半，而且笔记也不知道会不会去写，，先挖坑</p><p>这本书其实是邓在武汉大学的课堂的录音记录，由他研究生整理转为文字的</p><span id="more"></span><div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>为什么要读黑格尔？其实没太多想法，就是想读。如果硬是要找一个原因，那就是黑格尔和马克思有联系吧，毕竟马克思也算是他的学生了。读马克思主义著作的时候（特别是绿色的那本通识课教课书和《矛盾论》），总是被“辩证法”搞得晕头转向，看过了很多人的解析，唯独没看过黑格尔自己对辩证法的阐述，最终也只是停留马克思那句“辩证法在对现存事物的肯定的理解中同时包含对现存事物的否定的理解，即对现存事物的必然灭亡的理解；辩证法对每一种既成的形式都是从不断的运动中，因而也是从它的暂时性方面去理解辩证法不崇拜任何东西，按其本质来说，它是<strong>批判的和革命的</strong>”。这句话，我是当作熵增原理来理解的，也就是说混乱度总是不断得增加的，事物不停地否定其自身，趋向无序。但是这个理解，现在想想又是有问题的，如果人类社会是趋于无序的，那么马克思所设想的共产主义社会，就是为了解决资本主义社会下“社会生产的无政府状态”啊，共产主义就是为了在社会生产上实现有序化（另一设想“人的自由全面发展”也许可以当作是一种无序化（和景观社会相反），但这并不是盲目的，而是自觉自为的无序化，这种“自觉自为”又可以理解为另一种有序化，也就是说每个人都“自觉自为”地追求着每个人自己的自由，从整体上看这也是一种有序化）；而且把辩证法当作是熵增原理来看，这和恩格斯总结的辩证法的第三条规律“否定之否定”矛盾了，因为他的“否定之否定”是把人类历史看作是螺旋上升的，而不是螺旋下降的，很明显，人类社会是<strong>有目的</strong>地对外做功来减少熵增的，“生命以负熵为食”。所以辩证法就不能用单纯的熵增来看待了，熵增原理可以解释对外做功能够减少孤立系统的熵（当然对于地球来说仍然是熵增，而且增加速率会更加大），但是解释不了为什么要对外做功，即人类为什么会有目的，人类社会为什么会有目的。</p><p>对于黑格尔的兴趣，也来自一本关于Mega2（《马克思恩格斯全集》历史考证版第二版）的论文集，读前言的时候看到马克思的资本论和黑格尔的辩证法有很大的关系。其实在这之前，我就对教课书上普遍讲的“马克思对黑格尔的辩证法的颠倒”表示怀疑，如果只是对黑格尔的理论的简单颠倒，那马克思其实没什么原创水平，而且黑格尔作为辩证思维的创始人，应该是对自己的理论的反面有过反思的，是思考过的。虽然我对黑格尔的辩证法不熟悉，在阅读关于马克思的理论的论文时候，那些教授会说一句什么对黑格尔的颠倒，但是他却没有说明这是一种什么样的颠倒，读起来稀里糊涂的，被我用奥卡姆剃刀剃掉了。在读了邓的这本书的前面50%的情况下，我的直觉还是挺对的。</p><p>写到这里先烂尾了，，，</p></div>]]></content>
    
    
    <summary type="html">邓晓芒《黑格尔辩证法讲演录》读书笔记</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>如何白嫖和使用GitHub models的LLM（gpt4o和Llama-3.1-405b）</title>
    <link href="https://xingpingcn.top/using-github-models.html"/>
    <id>https://xingpingcn.top/using-github-models.html</id>
    <published>2024-09-05T04:31:40.632Z</published>
    <updated>2024-09-05T05:27:44.218Z</updated>
    
    <content type="html"><![CDATA[<p>刚刚通过了申请，然后马上去玩了一下GitHub提供LLM，总的来说，Llama-3.1-405b每天可以用50次，gpt4o 150次！</p><span id="more"></span><p>你需要先申请，然后等着通过。</p><p>通过之后，根据你的使用方法来填写url</p><ul><li>nextchat、oneapi<ul><li>https://models.inference.ai.azure.com/chat/completions#</li><li>注：后面的井号不可省略</li></ul></li><li>lobechat<ul><li>https://models.inference.ai.azure.com</li></ul></li></ul><p>token的话就是你的GitHub token。没有token的看<a href="https://docs.github.com/zh/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens" target="_blank" rel="noopener external nofollow noreferrer">这里</a></p><p>模型看这里</p><div class="tag link"><a class="link-card" title="GitHub models模型" href="https://github.com/marketplace/models"><div class="left"><img src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">GitHub models模型</p><p class="url">https://github.com/marketplace/models</p></div></a></div><p>你可以点进去看每个模型的详细，在右边有显示现在的速率是高还是低</p><p>之后你可以通过这里查看对应的限制速率。</p><div class="tag link"><a class="link-card" title="GitHub models速率限制" href="https://docs.github.com/zh/github-models/prototyping-with-ai-models#rate-limits"><div class="left"><img src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">GitHub models速率限制</p><p class="url">https://docs.github.com/zh/github-models/prototyping-with-ai-models#rate-limits</p></div></a></div><p>总的来说，Llama-3.1-405b每天可以用50次，gpt4o 150次！</p>]]></content>
    
    
    <summary type="html">白嫖和使用GitHub models的LLM，现在有gpt4o和Llama-3.1-405b，还要其他小一点的模型</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>使用rclone和alist加密和备份你的数据到公有云</title>
    <link href="https://xingpingcn.top/backup-your-data-using-rclone-and-alist-with-encryption.html"/>
    <id>https://xingpingcn.top/backup-your-data-using-rclone-and-alist-with-encryption.html</id>
    <published>2024-08-31T13:33:55.484Z</published>
    <updated>2024-10-14T15:06:08.278Z</updated>
    
    <content type="html"><![CDATA[<p>因为我用的甲骨文 vps，可能会玄学删 vps，所以需要频繁备份。放在国内公有云又怕审查，放谷歌微软的公有云容量又太少，歪门邪道又可能被删数据。有了 alist 就可以方便加密和解密数据，把加密后的数据放国内公有云就不怕审查了。用 alist 还有一个好处就是，如果你的数据同步到了多个公有云，alist 是可以很方便集中显示和管理公有云的文件的。rclone 也是常规的同步工具，直接备份 docker 文件夹就是了，这边就稍微记录一下。</p><span id="more"></span><div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>想要达成前面说到的目的，你需要：</p><div class="note done"><p><strong>需要的东西</strong></p><ol><li>alist，并注册多个国内公有云账号，会把 vps 的数据同步到多个公有云</li><li>安装好 rclone。直接用官网提供的 <a href="https://rclone.org/install/" target="_blank" rel="noopener external nofollow noreferrer">bash</a>，就没必要用 docker 了，因为可能要经常敲命令行，如果用 docker 还得进入 docker 才可以敲。</li></ol></div></div><div class="story post-story"><h2 id="配置-alist"><a href="#配置-alist" class="headerlink" title="配置 alist"></a>配置 alist</h2><p>alist 可以很方便加密数据并上传到公有云。见<a href="https://alist.nn.ci/zh/guide/drivers/Crypt.html" target="_blank" rel="noopener external nofollow noreferrer">官网教程</a>。</p><p>这里稍微说明一下怎么做</p><ol><li>先把公有云（如阿里云，天翼云）添加到<code>alist</code></li><li>之后创建<code>Crypt</code>驱动，填写<code>Crypt</code>的路径，并且填写加密后的文件所在路径。例如，阿里云挂在到了<code>/ali</code>，那么需要在这个<code>/ali</code>里面预先创建一个空的文件夹，例如<code>/ali/test</code>，之后在<code>Crypt</code>配置里，填写<code>Crypt</code>本身的路径，例如<code>/Crypt</code>，之后填写加密后的文件所在路径，也就是<code>/ali/test</code>。</li></ol><p>那么就可以通过访问<code>/Crypt</code>来加密解密<code>/ali/test</code>里的文件了，上传文件到<code>/Crypt</code>也就同样可以加密文件到<code>/ali/test</code>。</p><p>之后如果你选择把同一个文件加密到多个公有云，使用 alist 的<a href="https://alist.nn.ci/zh/guide/drivers/alias.html" target="_blank" rel="noopener external nofollow noreferrer">别名</a>功能可以方便集中显示和管理分布在各个公有云的文件。</p><p>同样不要忘记导出 alist 的配置，可以用中文的密码，更加难破解。在 alist 的 dash 中不能直接输入中文，可以在别处输入了密码后，再复制粘贴到 dash。</p></div><div class="story post-story"><h2 id="配置-rclone"><a href="#配置-rclone" class="headerlink" title="配置 rclone"></a>配置 rclone</h2><p>通过 alist 来中转而不是直接在 rclone 中挂载公有云的原因是，rclone 挂载起来没有 alist 方便，而且 alist 文档写的比较清楚。我一开始是用 rclone 来挂载谷歌云盘的，官网教程用的谷歌云盘的 oauth api，结果弄到后面需要我在有浏览器的电脑里，下载 rclone 然后再用浏览器登录，把 cookie 复制到 vps，，，</p><p>rclone 可以直接挂载 alist 的 <a href="https://alist.nn.ci/zh/guide/webdav.html" target="_blank" rel="noopener external nofollow noreferrer">webdav</a>，例如挂载 alist 的 <code>/ali/test</code>，就填写 <a href="http://127.0.0.1:port/dav/ali/test，注意你">http://127.0.0.1:port/dav/ali/test，注意你</a> alist 的端口，还要要加<code>/dav</code>前缀。</p><p>输入 <code>rclone config</code> 就可以挂载 webdav。webdav 的用户和密码同 alist 的登录用户密码。</p><h3 id="配置同步"><a href="#配置同步" class="headerlink" title="配置同步"></a>配置同步</h3><div class="note warning"><p><strong>rclone sync and copy</strong></p><p><code>rclone sync</code>命令可以方便同步改变了内容的文件，例如 test.txt 中改变了一个字符，这时候运行同步命令就可以同步，如果再一次运行同步命令，则不会重复上传文件到公有云，节省了带宽。如果删除文件也会同步删除，<code>rclone copy</code>则不会同步删除。<code>sync</code>命令同样可以备份公有云端要删除的文件，具体见官网文档。</p></div><p>建议把同步命令写到 .sh 里，方便管理。<code>rclone sync</code>需要先了解怎么用。</p><figure class="highlight bash"><figcaption><span>/home/rclone/bash.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rclone <span class="built_in">sync</span> /home/dcoker-data ali:/dcoker-data \</span><br><span class="line"> --copy-links --exclude-from /home/exclude.txt –ignore-size --disable-http-keep-alives --update</span><br><span class="line"></span><br><span class="line"><span class="comment">## --copy-links 复制软连接</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## --exclude-from 排除某些文件或者文件夹。语法见 &lt;https://rclone.org/filtering/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --dry-run 检查哪些文件要同步</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以在 exclude.txt 中定义不同步哪些文件。这里给一个样板。</p><figure class="highlight txt"><figcaption><span>/home/exclude.txt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tmp/**</span><br><span class="line">icon_cache/**</span><br><span class="line">**pycache**/**</span><br><span class="line">netlify_cert/logs/**</span><br><span class="line">\*.pem</span><br><span class="line">alist/alist-data/log/**</span><br><span class="line">alist/alist-data/temp/**</span><br></pre></td></tr></table></figure><p>可以定时备份。</p><figure class="highlight bash"><figcaption><span>cron</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 手动把本文件放在/etc/cron.d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后运行 service cron restart</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果需要使用其他用户运行，请改掉 root</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要注意的是最后的那个空行不能删除</span></span><br><span class="line"></span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">0 0/8 \*\* ? root /bin/bash /home/rclone/bash.sh &gt; /tmp/rclone.log 2&gt;&amp;1</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
    
    
    <summary type="html">利用alist管理多个公有云，使用alist加密数据，并将公有云以WebDAV的形式暴露给rclone，方便rclone同步数据</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>curl遇到的坑</title>
    <link href="https://xingpingcn.top/curl-learning.html"/>
    <id>https://xingpingcn.top/curl-learning.html</id>
    <published>2024-06-09T09:21:09.243Z</published>
    <updated>2024-06-09T10:20:50.650Z</updated>
    
    <content type="html"><![CDATA[<p>一开始我是这么写的</p><figure class="highlight bash"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取更新后的证书和私钥文件路径</span></span><br><span class="line">CERT_PATH=$(<span class="built_in">cat</span> ./netlify_cert/domain.com.cert.pem)</span><br><span class="line">KEY_PATH=$(<span class="built_in">cat</span> ./netlify_cert/domain.com.key.pem)</span><br><span class="line">FULLCHAIN_CERT_PATH=$(<span class="built_in">cat</span> ./netlify_cert/domain.com.fullchain.pem)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 Netlify API 上传证书</span></span><br><span class="line">curl -X POST \</span><br><span class="line">  -H <span class="string">&quot;Authorization: Bearer <span class="variable">$NETLIFY_API_KEY</span>&quot;</span> \</span><br><span class="line">  -d <span class="string">&quot;key=<span class="variable">$&#123;KEY_PATH&#125;</span>&quot;</span> \</span><br><span class="line">  -d <span class="string">&quot;ca_certificates=<span class="variable">$&#123;FULLCHAIN_CERT_PATH&#125;</span>&quot;</span> \</span><br><span class="line">  -d <span class="string">&quot;certificate=<span class="variable">$&#123;CERT_PATH&#125;</span>&quot;</span> \</span><br><span class="line">  <span class="string">&quot;https://api.netlify.com/api/v1/sites/<span class="variable">$&#123;NETLIFY_SITE_ID&#125;</span>/ssl&quot;</span></span><br></pre></td></tr></table></figure><p>这么写看着没用什么问题，但是<code>-d</code>命令是默认进行<code>urlencode</code>的，这样子我的证书就会改变。需要改成<code>--form-string</code>才行。</p><p>这种默认就<code>urlencode</code>的，<code>curl -h</code>中又没说明，真的好坑</p>]]></content>
    
    
    <summary type="html">curl中post表格的时候的坑</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>解决升级umamiv2.11时出现的P3009错误</title>
    <link href="https://xingpingcn.top/solve-p3009-error-using-umami.html"/>
    <id>https://xingpingcn.top/solve-p3009-error-using-umami.html</id>
    <published>2024-04-27T08:54:41.507Z</published>
    <updated>2024-06-03T14:34:47.221Z</updated>
    
    <content type="html"><![CDATA[<hr><p>鉴于中文互联网上关于这个问题的内容很少，我还是水一篇吧</p><span id="more"></span><div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>先放issue</p><div class="tag link"><a class="link-card" title="p3009 issue" href="https://github.com/umami-software/umami/issues/2645#issuecomment-2080419741"><div class="left"><img src="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">p3009 issue</p><p class="url">https://github.com/umami-software/umami/issues/2645#issuecomment-2080419741</p></div></a></div><p>我是在vercel上部署的，所以issue里面提到的用py或者shell去迁移数据库的方法我是实现不了的，只能在build阶段就把问题解决。</p></div><div class="story post-story"><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>在<code>package.json</code>找到</p><figure class="highlight plaintext"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;build-db&quot;: &quot;npm-run-all copy-db-files build-db-client&quot;,</span><br></pre></td></tr></table></figure><p>然后改成</p><figure class="highlight plaintext"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;build-db&quot;: &quot;npm-run-all copy-db-files build-db-client resolve-db&quot;,</span><br><span class="line">&quot;resolve-db&quot;: &quot;prisma migrate resolve --applied &#x27;05_add_visit_id&#x27;&quot;,</span><br></pre></td></tr></table></figure><p>就可以了</p></div><div class="story post-story"><h2 id="我是怎么样定位到问题所在的"><a href="#我是怎么样定位到问题所在的" class="headerlink" title="我是怎么样定位到问题所在的"></a>我是怎么样定位到问题所在的</h2><p>还是再写多一点</p><p>打开vercel日志，之后打开GitHub</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240427/image.6m3p8x2h30.webp' data-fancybox='default' data-caption='vercel日志' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 48.072916666666664%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240427/image.6m3p8x2h30.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240427/image.6m3p8x2h30.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="vercel日志" loading="lazy">            </a><span class='image-caption'>vercel日志</span></div><br><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240427/image.4qr4gat6tr.webp' data-fancybox='default' data-caption='GitHub' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 48.072916666666664%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240427/image.4qr4gat6tr.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240427/image.4qr4gat6tr.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="GitHub" loading="lazy">            </a><span class='image-caption'>GitHub</span></div></div><p>图片里面写的很明白，看不到或者看不懂评论区留言</p></div>]]></content>
    
    
    <summary type="html">&lt;hr&gt;
&lt;p&gt;鉴于中文互联网上关于这个问题的内容很少，我还是水一篇吧&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>列举几个免费域名和权威dns服务器</title>
    <link href="https://xingpingcn.top/%E5%85%8D%E8%B4%B9%E5%9F%9F%E5%90%8D%E5%92%8C%E6%9D%83%E5%A8%81dns%E6%9C%8D%E5%8A%A1%E5%99%A8.html"/>
    <id>https://xingpingcn.top/%E5%85%8D%E8%B4%B9%E5%9F%9F%E5%90%8D%E5%92%8C%E6%9D%83%E5%A8%81dns%E6%9C%8D%E5%8A%A1%E5%99%A8.html</id>
    <published>2024-04-04T14:31:45.765Z</published>
    <updated>2024-04-04T15:39:44.264Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="免费域名"><a href="#免费域名" class="headerlink" title="免费域名"></a>免费域名</h2><ul><li><a href="https://www.sitelutions.com/" target="_blank" rel="noopener external nofollow noreferrer">www.sitelutions.com</a><ul><li>优点<ul><li>这个能分配一个二级子域名，有很多域名，可以自定义NS</li><li>长期免费</li></ul></li><li>缺点<ul><li>但是不是所有都可以用，能用的子域名都不能部署在vercel，可以部署在netlify</li></ul></li></ul></li><li><a href="https://freedomain.one/index.jsp" target="_blank" rel="noopener external nofollow noreferrer">freedomain.one</a><ul><li>同上</li></ul></li><li><a href="https://nic.eu.org/" target="_blank" rel="noopener external nofollow noreferrer">nic.eu.org</a><br>这个基本大家都有了<ul><li>优点<ul><li>子域名都能部署在vercel</li><li>长期免费</li><li>有dnssec</li></ul></li><li>缺点<ul><li>大概率被墙</li><li>申请要等比较久</li></ul></li></ul></li><li><a href="https://www.cloudns.net/" target="_blank" rel="noopener external nofollow noreferrer">cloudns.net</a><br>这本身是一个dns服务器，但是可以获得一个子域名<ul><li>优点<ul><li>可以绑定到cf</li></ul></li><li>缺点<ul><li>只能绑定到cf</li><li>新账号分配的子域名似乎不能绑定到cf</li></ul></li></ul></li><li><a href="https://www.azote.org/" target="_blank" rel="noopener external nofollow noreferrer">www.azote.org</a><ul><li>优点<ul><li>可以申请很多域名</li></ul></li><li>缺点<ul><li>不能绑定到cf，但是可以通过cf的SaaS来CNAME进行域名加速</li></ul></li></ul></li><li><a href="https://secure.nom.za/" target="_blank" rel="noopener external nofollow noreferrer">secure.nom.za</a><ul><li>优点<ul><li>可以绑定到cf</li></ul></li><li>缺点<ul><li>一个月不用会被回收</li></ul></li></ul></li><li><a href="https://www.vpsor.cn/" target="_blank" rel="noopener external nofollow noreferrer">硅云</a><ul><li>优点<ul><li>免费一年的<code>.xyz</code>或者<code>.top</code>域名</li></ul></li><li>缺点<ul><li>只有新用户才有1年的免费使用</li><li>国产</li></ul></li></ul></li></ul><p>此外还有pp.ua，虽然免费但是要绑定银行卡，每年续费</p><p>https://dns.beaa.cn/  免费二级域名</p></div><div class="story post-story"><h2 id="免费权威dns服务器"><a href="#免费权威dns服务器" class="headerlink" title="免费权威dns服务器"></a>免费权威dns服务器</h2><ul><li><a href="https://www.cloudns.net/" target="_blank" rel="noopener external nofollow noreferrer">cloudns.net</a><br>这本身是一个dns服务器，但是可以获得一个子域名<ul><li>优点<ul><li>申请简单，可以拿到一个免费域名</li><li>可以转移到cf，这样就没有解析次数限制</li></ul></li><li>缺点<ul><li>速度一般</li><li>新账号分配的子域名似乎不能绑定到cf</li><li>如果用它自己的dns解析只能每个月用500k次，转到cf就没有限制了</li></ul></li></ul></li><li><a href="https://my.nsone.net/" target="_blank" rel="noopener external nofollow noreferrer">NS1</a><ul><li>优点<ul><li>可以说是目前最牛的DNS服务器了，最近被IBM收购，文档有点乱，应该很快就会改</li><li>相对于其他国外的dns服务器来说，免费版在国内速度不错。而且他有国内和京东云合作的中国特供dns服务器，非常快，但是不免费</li><li>功能非常强大，免费版就可以体验到特色功能<code>filter chain</code>。我写过一篇<a href="https://xingpingcn.top/%E5%85%8D%E8%B4%B9%E9%80%9A%E8%BF%87ns1%E5%88%A9%E7%94%A8%E7%9B%91%E6%8E%A7%E5%AE%9D%E5%B9%B3%E5%8F%B0%E5%AE%9E%E7%8E%B0%E5%AE%9E%E6%97%B6%E5%9F%BA%E4%BA%8E%E4%B8%8D%E5%90%8C%E8%BF%90%E8%90%A5%E5%95%86%E7%9A%84%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB.html#NS1-com%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B">教程</a>介绍如何使用。付费版还有更多强大功能。</li><li>每个月5m次解析，1个<code>filter chain</code></li><li>可以接入http测速等监控工具（包括第三方服务和自定义的），实现自动故障转移</li><li>可以有国内的分路线解析。我写过一篇<a href="https://xingpingcn.top/%E5%85%8D%E8%B4%B9%E9%80%9A%E8%BF%87ns1%E5%88%A9%E7%94%A8%E7%9B%91%E6%8E%A7%E5%AE%9D%E5%B9%B3%E5%8F%B0%E5%AE%9E%E7%8E%B0%E5%AE%9E%E6%97%B6%E5%9F%BA%E4%BA%8E%E4%B8%8D%E5%90%8C%E8%BF%90%E8%90%A5%E5%95%86%E7%9A%84%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB.html#NS1-com%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B">教程</a>介绍如何使用</li><li>有dnssec</li></ul></li><li>缺点<ul><li>申请困难</li><li>不知道为什么会有很多dns解析占用你的免费额度</li></ul></li></ul></li><li><a href="https://www.netlify.com/" target="_blank" rel="noopener external nofollow noreferrer">netlify</a><br>是的，就是那个可以部署项目的netlify，他也有dns服务<ul><li>优点<ul><li>它是接入ns1的，也就是说你可以享受ns1的速度，但是没有ns1的次数限制</li></ul></li><li>缺点<ul><li>基本上就体验不到ns1的各种功能了</li></ul></li></ul></li><li>vercel<ul><li>优点<ul><li>一样的没有次数限制，速度可以</li></ul></li><li>缺点<ul><li>功能少</li></ul></li></ul></li><li>华为云<ul><li>优点<ul><li>有分路线解析</li><li>国际版不用绑定手机号和银行卡</li><li>SOA没有指向此NS也能添加域名</li></ul></li><li>缺点<ul><li>速度一般，不稳定</li><li>分路线解析一般般，识别不能说很准确</li><li>作为国内dns服务器功能较少，如307重定向这种，和类似dnspod的http监控</li><li>500条dns记录。是的，他能绑定50个域名，可是<strong>总共</strong>只能添加500条dns解析。有点神经病了，不过它可以申请提高这个限制，我不知道容易不容易</li><li>无dnssec</li></ul></li></ul></li><li>cf<ul><li>优点<ul><li>免费，无限制</li><li>可以用cdn</li></ul></li><li>缺点<ul><li>没有分路线解析</li><li>国内解析很慢，cdn很慢</li><li>不能添加子域名，某些特殊的子域名可以</li></ul></li></ul></li><li>dnspod<ul><li>优点<ul><li>有免费的http测速和负载均衡</li></ul></li><li>缺点<ul><li>国际版也要绑定银行卡</li></ul></li></ul></li><li><a href="https://dns.he.net/" target="_blank" rel="noopener external nofollow noreferrer">dns.he.net</a><br>国外老牌<ul><li>优点<ul><li>国内速度快</li><li>有ddns</li><li>SOA没有指向此NS也能添加域名</li><li>记录类型多</li></ul></li><li>缺点<ul><li>暂时想不到</li></ul></li></ul></li><li><a href="https://www.geoscaling.com/dns2/index.php?module=auth" target="_blank" rel="noopener external nofollow noreferrer">geoscaling.com</a><ul><li>优点<ul><li>就像它的名字一样，可以根据地理位置解析</li><li>速度还行</li></ul></li><li>缺点<ul><li>想要按照地理位置解析，规则编写起来很麻烦</li></ul></li></ul></li></ul></div>]]></content>
    
    
    <summary type="html">说一下我用过的免费域名和权威dns服务器的优缺点</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>提升部署在cloudflare、vercel或netlify的网站在中国国内的访问速度和稳定性</title>
    <link href="https://xingpingcn.top/enhanced-faas-in-cn.html"/>
    <id>https://xingpingcn.top/enhanced-faas-in-cn.html</id>
    <published>2024-03-31T16:00:00.000Z</published>
    <updated>2024-10-01T15:33:33.656Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>因为官方默认的cname解析出来的ip在国内访问的稳定性都很差，所以写了这个项目</p><div class="note warning"><p><strong>IMPORTENT</strong></p><p>本 post 更新不及时，请点击下方 GitHub repo 查看！</p></div></div><div class="story post-story"><h2 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h2><p>先放repo，欢迎提交issue。</p><div class="tag link"><a class="link-card" title="enhanced-FaaS-in-China" href="https://github.com/xingpingcn/enhanced-FaaS-in-China"><div class="left"><img src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">enhanced-FaaS-in-China</p><p class="url">https://github.com/xingpingcn/enhanced-FaaS-in-China</p></div></a></div><ul><li>如果你的网站部署在<code>cf</code>，则把cname记录改为：<ul><li><code>cf-cname.xingpingcn.top</code><ul><li>使用此dns解析建议：如果你的域名托管在cloudflare，那么使用这个cname很有可能会遇到403。建议把你的域名托管在非cloudflare平台，然后再在cf平台中删除你的站点，之后再使用。测速的时候一定要看下面的图。如果有些服务，例如cf worker，必须要把域名托管在cf，那么建议你使用cf的saas功能。</li></ul></li></ul></li><li>如果你的网站部署在<code>vercel</code>，则把cname记录改为：<ul><li><code>vercel-cname.xingpingcn.top</code></li></ul></li><li>如果你的网站部署在<code>netlify</code>，则把cname记录改为：<ul><li><code>netlify-cname.xingpingcn.top</code></li></ul></li><li>如果你的网站部署在<code>netlify</code>和<code>vercel</code>上，则把cname记录改为：<ul><li><code>verlify-cname.xingpingcn.top</code><ul><li>使用此dns解析建议：先把cname记录改为官方提供的url，等<code>ssl/tls证书</code>生成之后再把cname记录改为<code>verlify-cname.xingpingcn.top</code></li></ul></li></ul></li></ul><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240630/how2test.6m3rso0k2b.webp' data-fancybox='default' data-caption='怎么测速' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 79.15543575920934%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240630/how2test.6m3rso0k2b.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240630/how2test.6m3rso0k2b.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="怎么测速" loading="lazy">            </a><span class='image-caption'>怎么测速</span></div></div><h3 id="可能存在的问题"><a href="#可能存在的问题" class="headerlink" title="可能存在的问题"></a>可能存在的问题</h3><ol><li><del>浙江、福建、河南的个别isp访问可能会失败</del> 目前似乎只有泉州被墙（官方的cname也是同样的问题，或许是isp限制导致的）</li><li>对于测速工具的选择，itdog.cn测出来的结果有点问题（会出现大片的红，原因未知），可以试试用boce.com、cesu.net之内的来测</li></ol></div><div class="story post-story"><h2 id="测速结果"><a href="#测速结果" class="headerlink" title="测速结果"></a>测速结果</h2><h3 id="CF"><a href="#CF" class="headerlink" title="CF"></a>CF</h3><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240626/cf-22.5utc8-2024-6-26.77df9a5ds5.png' data-fancybox='default' data-caption='cf-22点' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 29.273084479371317%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240626/cf-22.5utc8-2024-6-26.77df9a5ds5.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240626/cf-22.5utc8-2024-6-26.77df9a5ds5.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="cf-22点" loading="lazy">            </a><span class='image-caption'>cf-22点</span></div></div><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240612/cf-22utc8-auth.4ckqkd14ez.webp' data-fancybox='default' data-caption='cf-22点-官方' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 36.59701492537314%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240612/cf-22utc8-auth.4ckqkd14ez.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240612/cf-22utc8-auth.4ckqkd14ez.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="cf-22点-官方" loading="lazy">            </a><span class='image-caption'>cf-22点-官方</span></div><br><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240612/cf-23utc8-auth.2krrpghrim.webp' data-fancybox='default' data-caption='cf-23点-官方' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 36.738351254480285%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240612/cf-23utc8-auth.2krrpghrim.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240612/cf-23utc8-auth.2krrpghrim.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="cf-23点-官方" loading="lazy">            </a><span class='image-caption'>cf-23点-官方</span></div></div><h3 id="Vercel"><a href="#Vercel" class="headerlink" title="Vercel"></a>Vercel</h3><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/vercel-noon-auth.9nzkp19pu8.webp' data-fancybox='default' data-caption='vercel中午-官方' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 38.10096153846154%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/vercel-noon-auth.9nzkp19pu8.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/vercel-noon-auth.9nzkp19pu8.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="vercel中午-官方" loading="lazy">            </a><span class='image-caption'>vercel中午-官方</span></div><br><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/vercel-noon.45hg8w1hql.webp' data-fancybox='default' data-caption='vercel中午' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 36.428999400838826%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/vercel-noon.45hg8w1hql.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/vercel-noon.45hg8w1hql.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="vercel中午" loading="lazy">            </a><span class='image-caption'>vercel中午</span></div></div><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/vercel-23utc8-auth.32hqy05nuy.webp' data-fancybox='default' data-caption='vercel-23点晚高峰-官方' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 36.706586826347305%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/vercel-23utc8-auth.32hqy05nuy.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/vercel-23utc8-auth.32hqy05nuy.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="vercel-23点晚高峰-官方" loading="lazy">            </a><span class='image-caption'>vercel-23点晚高峰-官方</span></div><br><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/vercel-23utc8.41xub68f0n.webp' data-fancybox='default' data-caption='vercel-23点晚高峰' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 36.857825567502985%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/vercel-23utc8.41xub68f0n.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/vercel-23utc8.41xub68f0n.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="vercel-23点晚高峰" loading="lazy">            </a><span class='image-caption'>vercel-23点晚高峰</span></div></div><h3 id="Netlify"><a href="#Netlify" class="headerlink" title="Netlify"></a>Netlify</h3><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/netlify-noon-auth.4cko4bnn5v.webp' data-fancybox='default' data-caption='netlify中午-官方' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 37.19951923076923%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/netlify-noon-auth.4cko4bnn5v.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/netlify-noon-auth.4cko4bnn5v.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="netlify中午-官方" loading="lazy">            </a><span class='image-caption'>netlify中午-官方</span></div><br><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/netlify-noon.1zi1n49tz3.webp' data-fancybox='default' data-caption='netlify中午' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 36.98547215496368%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/netlify-noon.1zi1n49tz3.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/netlify-noon.1zi1n49tz3.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="netlify中午" loading="lazy">            </a><span class='image-caption'>netlify中午</span></div></div><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/netlify-23utc8-auth.5mnlan5mgt.webp' data-fancybox='default' data-caption='netlify-23点晚高峰-官方' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 36.56493117893477%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/netlify-23utc8-auth.5mnlan5mgt.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/netlify-23utc8-auth.5mnlan5mgt.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="netlify-23点晚高峰-官方" loading="lazy">            </a><span class='image-caption'>netlify-23点晚高峰-官方</span></div><br><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/netlify-23utc8.8z6b50m6sx.webp' data-fancybox='default' data-caption='vercel-23点晚高峰' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 36.510791366906474%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/netlify-23utc8.8z6b50m6sx.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240412/netlify-23utc8.8z6b50m6sx.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="vercel-23点晚高峰" loading="lazy">            </a><span class='image-caption'>vercel-23点晚高峰</span></div></div></div><div class="story post-story"><h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><h3 id="Q：和官方提供的cname有什么差别？"><a href="#Q：和官方提供的cname有什么差别？" class="headerlink" title="Q：和官方提供的cname有什么差别？"></a>Q：和官方提供的cname有什么差别？</h3><p>A：</p><ul><li>官方的cname有时在平均速度上是很快的，但是缺乏稳定性，会出现好几个省份都访问不了的情况，又或者个别省份相应时间非常长</li><li>而我的cname在平均速度上可能不是最快的，平均响应速度尽量维持在1秒内，最长的响应时间控制在2秒内，而返回非200状态码的省份尽量少于等于2个</li></ul><h3 id="Q：为什么分路线解析不准确？"><a href="#Q：为什么分路线解析不准确？" class="headerlink" title="Q：为什么分路线解析不准确？"></a>Q：为什么分路线解析不准确？</h3><p>A：我使用的是权威DNS服务器自带的路线解析，可能存在误判。如果你想要更加精准的分路线解析，可以自行选取其他DNS服务器——如dnspod——并添加<a href="https://raw.githubusercontent.com/xingpingcn/enhanced-FaaS-in-China/main/Netlify.json" target="_blank" rel="noopener external nofollow noreferrer">Netlify.json</a>或<a href="https://raw.githubusercontent.com/xingpingcn/enhanced-FaaS-in-China/main/Vercel.json" target="_blank" rel="noopener external nofollow noreferrer">Vercel.json</a>里的IP到A记录。或使用<code>NS1.COM</code>作为权威DNS服务器，并设置根据<code>ASN</code>进行路线解析。你可以看看我写的<a href="https://github.com/xingpingcn/china-mainland-asn" target="_blank" rel="noopener external nofollow noreferrer">ASN列表</a>。<br></p><h3 id="Q：为什么设置了你的CNAME解析后网站不能访问？"><a href="#Q：为什么设置了你的CNAME解析后网站不能访问？" class="headerlink" title="Q：为什么设置了你的CNAME解析后网站不能访问？"></a>Q：为什么设置了你的CNAME解析后网站不能访问？</h3><p>A：</p><ul><li>这大概率是使用了<code>verlify-cname.xingpingcn.top</code>导致的。需要先把CNAME记录改为官方提供的链接，等待SSL证书生成后再重新设置。这是由于该解析包含两个平台的IP，平台每次访问都会获得二者之一的IP，因而认为你在平台所填写的域名并不是你所拥有的。但是一旦生成证书后，证书就会缓存在平台上。</li><li>netlify<a href="https://github.com/xingpingcn/enhanced-FaaS-in-China/blob/main/netlify_cert/readme.md" target="_blank" rel="noopener external nofollow noreferrer">支持上传自己的证书</a>。如果还是不行就申请一个能自动续期的证书，写webhook，在证书更新的时候自动部署到netlify。</li></ul><h3 id="Q：为什么有的路线（如电信）的DNS-A记录解析是官方提供的默认IP？"><a href="#Q：为什么有的路线（如电信）的DNS-A记录解析是官方提供的默认IP？" class="headerlink" title="Q：为什么有的路线（如电信）的DNS A记录解析是官方提供的默认IP？"></a>Q：为什么有的路线（如电信）的DNS A记录解析是官方提供的默认IP？</h3><p>A：</p><p>这是因为该路线的其他IP质量较差，所以暂时停止解析其路线，改用官方提供的默认IP。你可以通过同时将网站部署在<code>vercel</code>和<code>netlify</code>，把cname解析改为<code>verlify-cname.xingpingcn.top</code>，从而提高容错率。两个平台同一线路同时失效的概率要低许多。</p><h3 id="Q：为什么json文件有的路线是一个空列表？"><a href="#Q：为什么json文件有的路线是一个空列表？" class="headerlink" title="Q：为什么json文件有的路线是一个空列表？"></a>Q：为什么json文件有的路线是一个空列表？</h3><p>A:</p><p>同上</p></div>]]></content>
    
    
    <summary type="html">通过优化的 CNAME 解析，改善 cloudflare、Vercel 和 Netlify 在中国大陆的访问速度和稳定性，解决官方默认解析的不稳定问题。附测速结果和常见问题解答</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>你的常用域名被其他vercel账号使用的解决方法</title>
    <link href="https://xingpingcn.top/domain-have-been-used-by-other-vercel-account.html"/>
    <id>https://xingpingcn.top/domain-have-been-used-by-other-vercel-account.html</id>
    <published>2024-03-28T02:27:26.850Z</published>
    <updated>2024-03-28T15:02:54.093Z</updated>
    
    <content type="html"><![CDATA[<p>先放链接</p><div class="tag link"><a class="link-card" title="社区维护者答复" href="https://github.com/orgs/vercel/discussions/6285"><div class="left"><img src="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">社区维护者答复</p><p class="url">https://github.com/orgs/vercel/discussions/6285</p></div></a></div><p>由于vercel最近在你的个人账户里添加了一个团队（team），你会发现你左上角的头像变了，然后点击中间<code>domain</code>按钮的时候发现里面并没有你之前使用过的域名。这个时候你在项目里添加域名，会提示说域名已经被其他账号使用。但是很困惑的是，只在前几天之前，你一直能够没有限制地添加域名，为什么这几天就变了。</p><p><strong>这是由于你的项目现在全部变为你的team的项目，而你的域名却仍然在你的账号之下。</strong></p><p>解决方法也很简单，点击右上角你的账号设置，然后点击左边的<code>domain</code>，选择你想要转移的域名，点击左边的三个点的按钮，然后点击<code>move</code>，就可以开始转移了。</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240328/image.7p262fo7b.webp' data-fancybox='default' data-caption='设置域名转移' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 48.072916666666664%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240328/image.7p262fo7b.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20240328/image.7p262fo7b.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="设置域名转移" loading="lazy">            </a><span class='image-caption'>设置域名转移</span></div></div>]]></content>
    
    
    <summary type="html">添加你域名的时候发现系统提示Another Vercel account is using this domain，这是由于最近vercel升级了你的账号导致的</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>cron笔记</title>
    <link href="https://xingpingcn.top/cron-learning-note.html"/>
    <id>https://xingpingcn.top/cron-learning-note.html</id>
    <published>2024-03-14T16:29:28.925Z</published>
    <updated>2024-06-09T14:14:32.767Z</updated>
    
    <content type="html"><![CDATA[<p>cron笔记，包含cron不执行shell脚本的解决办法</p><span id="more"></span><p>也许shell脚本本身可以执行，但是cron中不能执行，需要像下面这样设置</p><figure class="highlight plaintext"><figcaption><span>cron-for-run-per-1h.cron</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SHELL=/bin/bash </span><br><span class="line">0 * * * * . /etc/profile;/bin/sh /pathto/run.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note NOTE"><p><strong>NOTE</strong></p><p>最后一定要有一个回车！后者会导入失败</p></div><figure class="highlight bash"><figcaption><span>run.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">PATH=/opt/someApp/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">LOGS_FILE=<span class="string">&quot;/pathto/logs/<span class="subst">$(date <span class="string">&quot;+%Y-%m-%d-%H-%M-%S&quot;</span>)</span>.log&quot;</span></span><br><span class="line"><span class="built_in">cd</span> /pathto</span><br><span class="line">docker-compose up &gt;&gt; <span class="variable">$LOGS_FILE</span> 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>最后设置到cron</p><figure class="highlight bash"><figcaption><span>run.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab /pathto/cron-for-run-per-1h.cron</span><br></pre></td></tr></table></figure><div class="note warning"><p><strong>warning</strong></p><p>使用此命令会覆盖之前所有的cron任务</p></div><p>如果你不想覆盖之前的，那么就<code>/etc/cron.d</code>中新建文件，然后写进去。</p><div class="note warning"><p><strong>warning</strong></p><p>cron的话基本必有一个<code>?</code>，它仅可存在于<code>dayofmouth</code>或者<code>dayofweek</code></p></div><p>个人docker配置备份</p><figure class="highlight dockerfile"><figcaption><span>Dockerfile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.11</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /bin/test</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./requirements.txt ./</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install -r ./requirements.txt</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [ <span class="string">&quot;python&quot;</span> ]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [ <span class="string">&quot;./test.py&quot;</span> ]</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">enhanced-faas:</span></span><br><span class="line">    <span class="attr">build:</span> </span><br><span class="line">      <span class="attr">context:</span> <span class="string">./</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">enhanced-faas</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./:/bin/test&quot;</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">443</span><span class="string">,80</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">./main.py</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nginx-proxy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">nginx-proxy:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;cron笔记，包含cron不执行shell脚本的解决办法&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>让在vpc中的aws lambda函数不通过nat获得访问互联网的能力</title>
    <link href="https://xingpingcn.top/aws-lambda-access-internet-in-vpc-without-nat.html"/>
    <id>https://xingpingcn.top/aws-lambda-access-internet-in-vpc-without-nat.html</id>
    <published>2024-03-14T06:17:47.909Z</published>
    <updated>2024-03-28T15:02:26.965Z</updated>
    
    <content type="html"><![CDATA[<p>如果在使用aws lambda中，你的lambda函数需要访问aws的其他服务，例如EFS、RDS，那么大概率需要将你的lambda和efs放置在同一vpc中（不在同一vpc的情况下你可以使用endpoint），这个时候即使你的lambda是在公开子网（public subnet）中也是是没有访问互联网的能力的，这是因为你的lambda只有子网的ip10.0.0.0，流量路由到互联网网关的时候会被网关丢弃，因为你没有配置公网ip。本文会给出几个解决方案，并分析优缺点。</p><p>因为aws的文档大部分是英文，中文文档都是机翻，所以有些专有名词的翻译就很别扭，所以干脆直接用英文。</p><span id="more"></span><div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>正如前面所说，你的<code>lambda函数</code>所在的<code>vpc</code>需要配置<code>公网ip</code>才能拥有访问互联网的能力。你可能会说，为什么我平时用的lambda不需要加入vpc呢？</p><p>这是因为：</p><ol><li>你的lambda没有手动配置vpc。如果你的lambda没有手动配置vpc，那么aws会把你的lambda放进aws自己管理的vpc中，在该vpc中拥有公网ip，你的lambda可以访问互联网，但是你的lambda函数并不能访问该vpc下的其他aws服务（当然不能，难道你还能访问aws他自己的私有服务吗）</li><li>你的lambda并没有使用到其他aws服务。要使用其他aws服务，则该服务一定是要加入到你自己的vpc中的，例如你要把信息写进<code>json</code>文件并持久化，你需要s3或者EFS；例如你要访问ec2实例或RDS数据库。如果只是临时写入文件则可以在<code>/tmp</code>目录下写入，lambda运行结束则会被清空，不能持久化。</li></ol><br><p>要让lambda拥有同时访问互联网和vpc下的服务的能力，首先你要有公网ip，另外你的lambda能访问vpc下的服务。</p><p>我查阅了网上提到的几种方法，并总结下来</p><p>存在的解决方案有：</p><ol><li>配置<code>nat网关</code>。</li><li>配置<code>endpoint</code>。将你的程序解耦，分为两个lambda函数，一个用于访问互联网，另一个访问aws服务，二者通过endpoint进行通讯。</li><li>通过<code>API gateway</code>。同样地，你的程序需要解耦，其中用于访问aws服务的lambda被主lambda函数通过API调用。</li><li>通过aws lambda <code>api</code>。使用aws sdk（python使用<code>boto3</code>），通过<a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/lambda/client/invoke.html" target="_blank" rel="noopener external nofollow noreferrer">invoke</a>方法同步或异步调用另一个lambda。</li></ol></div><div class="story post-story"><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="配置nat网关"><a href="#配置nat网关" class="headerlink" title="配置nat网关"></a>配置nat网关</h3><p>这是官方推荐的方法。</p><h4 id="如何配置"><a href="#如何配置" class="headerlink" title="如何配置"></a>如何配置</h4><p>新建一个vpc，选择带有公网子网和私有子网的模板，然后勾选nat网关就可以。在可视化界面中你可以看到私有子网通过路由表（route table）将流量路由到nat网关。你把你的lambda和aws服务放进私有子网内，你的lambda就拥有了同时访问互联网和vpc下的aws服务的能力。路由表会根据<code>destination</code>帮你处理好一切。</p><h4 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h4><p>最简单也最贵。单单是一个nat网关开着它就要30美元一个月，转发的流量还需要另外收费。不清楚公网ip是否另外收费</p><h3 id="配置endpoint"><a href="#配置endpoint" class="headerlink" title="配置endpoint"></a>配置endpoint</h3><p>aws设置endpoint的目的是为了让处于不同的vpc下的服务不通过互联网而通过aws的内部网络相互通讯，从而减少安全风险。</p><h4 id="如何配置-1"><a href="#如何配置-1" class="headerlink" title="如何配置"></a>如何配置</h4><p>利用这个特性，你可以在将需要访问互联网的lambda放在aws他自己管理的vpc中（在创建lambda的时候默认会放进该vpc），将另一个lambda放到你的vpc中，该lambda函数用于访问同vpc下的aws服务，例如RDS。前者lambda通过endpoint访问后者。</p><p>值得注意的是，<code>endpoint</code>是安装在服务消费者（<code>service consumers</code>）上的，在上面的例子中，假设我是希望能访问互联网的lambda访问处于自定义vpc中的lambda，读取RDS数据并发送邮件。在这里，服务消费者是访问互联网的lambda，服务提供者（<code>service providers</code>）是处于自定义vpc中的lambda，前面提到，<code>endpoint</code>应该被安装在服务消费者——也就是访问互联网的lambda中，但是，该lambda是放在aws自己管理的vpc中的，我们没有权限去创建一个<code>endpoint</code>，只能改变思路，就像下面的图所示，把处于自定义vpc中的lambda作为服务消费者，读取数据库，之后通过<code>endpoint</code>调用vpc外面的lambda。</p><div class="note done"><p><strong>NOTE</strong></p><p>在你的lambda中，可以通过编程的方式使用aws sdk（python是<code>boto3</code>）链接endpoint。sdk通常是发送一个<code>http请求</code>来调用<code>endpoint</code>。</p></div><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/image.2vehwoo1tl.webp' data-fancybox='default' data-caption='示例' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 56.441717791411044%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/image.2vehwoo1tl.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/image.2vehwoo1tl.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="示例" loading="lazy">            </a><span class='image-caption'>示例</span></div></div><h4 id="优缺点-1"><a href="#优缺点-1" class="headerlink" title="优缺点"></a>优缺点</h4><ul><li><p>优点</p><ul><li>费用比nat低</li><li>由于解耦，程序逻辑更加清晰，并且能提高复用率。如果你使用RDS，需要使用<code>RDS proxy</code>来复用同一个数据库连接。<br></li></ul></li><li><p>缺点</p><ul><li>高延迟+双重冷（热）启动</li><li>受到lambda的并发限制。免费账号只有10个并发，如果你要多次读写数据库则速度会很慢</li></ul></li></ul><h3 id="通过API-gateway"><a href="#通过API-gateway" class="headerlink" title="通过API gateway"></a>通过API gateway</h3><p><code>API gateway</code>的最佳用途应该是用来写<code>REST api</code>，你可以通过<code>API gateway</code>调用lambda函数</p><h4 id="如何配置-2"><a href="#如何配置-2" class="headerlink" title="如何配置"></a>如何配置</h4><p>编写两个lambda，其中用于访问aws服务的lambda设置<code>API gateway</code>触发器（<code>trigger</code>），因而用于访问互联网的lambda可以通过发送<code>http请求</code>到该url而调用另一个lambda，进而访问aws服务。</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/image.9gwbnsgq5f.webp' data-fancybox='default' data-caption='设置API gateway触发器（trigger）' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 28.81925013989927%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/image.9gwbnsgq5f.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/image.9gwbnsgq5f.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="设置API gateway触发器（trigger）" loading="lazy">            </a><span class='image-caption'>设置API gateway触发器（trigger）</span></div></div><h4 id="优缺点-2"><a href="#优缺点-2" class="headerlink" title="优缺点"></a>优缺点</h4><ul><li><p>优点</p><ul><li>有免费额度</li><li>不用设置endpoint</li><li>可以使用<code>http</code>来调用，调用起来更加方便</li><li>由于解耦，程序逻辑更加清晰，并且能提高复用率。如果你使用RDS，需要使用RDS proxy来复用同一个数据库连接。<br></li></ul></li><li><p>缺点</p><ul><li>高延迟+双重冷（热）启动</li><li>受到lambda的并发限制。免费账号只有10个并发，如果你要多次读写数据库则速度会很慢</li></ul></li></ul><h3 id="通过aws-lambda-api"><a href="#通过aws-lambda-api" class="headerlink" title="通过aws lambda api"></a>通过aws lambda api</h3><p>和其他aws服务一样，lambda也有自己的api。其中就包括调用lambda函数的<code>invoke</code>方法。</p><h4 id="如何配置-3"><a href="#如何配置-3" class="headerlink" title="如何配置"></a>如何配置</h4><p>如果你使用<code>python</code>，详见<a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/lambda/client/invoke.html" target="_blank" rel="noopener external nofollow noreferrer">invoke</a></p><h4 id="优缺点-3"><a href="#优缺点-3" class="headerlink" title="优缺点"></a>优缺点</h4><ul><li><p>优点</p><ul><li>api本身免费，运行的lambda有免费额度</li><li>由于解耦，程序逻辑更加清晰，并且能提高复用率。如果你使用RDS，需要使用RDS proxy来复用同一个数据库连接。<br></li></ul></li><li><p>缺点</p><ul><li>只能通过aws sdk使用，否则你要自行编写认证程序</li><li>高延迟+双重冷（热）启动</li><li>受到lambda的并发限制。免费账号只有10个并发，如果你要多次读写数据库则速度会很慢</li></ul></li></ul></div>]]></content>
    
    
    <summary type="html">分析在vpc中的aws lambda函数不通过nat获得访问互联网的能力的几种方法的优缺点</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>在存在父子文件结构情况下使用python import</title>
    <link href="https://xingpingcn.top/%E5%9C%A8%E5%AD%98%E5%9C%A8%E7%88%B6%E5%AD%90%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E4%B8%8B%E4%BD%BF%E7%94%A8py_import.html"/>
    <id>https://xingpingcn.top/%E5%9C%A8%E5%AD%98%E5%9C%A8%E7%88%B6%E5%AD%90%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E4%B8%8B%E4%BD%BF%E7%94%A8py_import.html</id>
    <published>2024-03-11T15:59:52.611Z</published>
    <updated>2024-05-24T10:28:12.864Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>网上的资料大多数都比较乱，包括<code>stackoverflow</code>也是，也就产生了这篇笔记。</p></div><div class="story post-story"><h2 id="文件结构和可能存在的引用链条"><a href="#文件结构和可能存在的引用链条" class="headerlink" title="文件结构和可能存在的引用链条"></a>文件结构和可能存在的引用链条</h2><p>现在有这样一个文件夹</p><figure class="highlight bash"><figcaption><span>文件夹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line">|____ a.py  <span class="comment"># 该文件作为演示的运行入口文件</span></span><br><span class="line">|____ b.py</span><br><span class="line">|____ c.py</span><br><span class="line">|____ dir1</span><br><span class="line">     |____d.py</span><br><span class="line">     |____e.py</span><br><span class="line">     |____dir2</span><br><span class="line">          |____x.py</span><br></pre></td></tr></table></figure><div class="note warning"><p><strong>IMPORTANT</strong></p><ul><li>我使用的是<code>python3.11</code>，该版本中不需要<code>__init__.py</code>也能把文件夹变成一个<code>package</code>。</li><li>如果你不能引入子文件夹，则直接在该文件夹中新建一个<code>__init__.py</code>，内容为空。</li></ul></div><p>可能存在的引用链条有</p><ul><li><p>a -&gt; d -&gt; b（引用父文件）</p>  <figure class="highlight python"><figcaption><span>python</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># a.py</span></span><br><span class="line"><span class="keyword">import</span> d</span><br><span class="line"><span class="comment"># d.py</span></span><br><span class="line"><span class="keyword">import</span> b</span><br></pre></td></tr></table></figure></li><li><p>a -&gt; d -&gt; x -&gt; e（引用子文件后再引用其父文件）</p></li><li><p>a -&gt; b -&gt; c</p></li><li><p>a -&gt; d -&gt; x -&gt; c</p></li></ul></div><div class="story post-story"><h2 id="非运行入口文件和运行入口文件"><a href="#非运行入口文件和运行入口文件" class="headerlink" title="非运行入口文件和运行入口文件"></a>非运行入口文件和运行入口文件</h2><div class="note warning"><p><strong>IMPORTANT</strong></p><p>一定要区分哪个是运行入口文件！</p></div><p>在<code>python a.py</code>中，<code>a.py</code>就是运行入口文件，其他的都不是。如果你<code>cd dir1 &amp; python e.py</code>，那么<code>a.py</code>就不是运行入口文件了，<code>e.py</code>才是。<code>一般</code>而言运行入口文件使用绝对引入。</p></div><div class="story post-story"><h2 id="绝对引入和相对引入"><a href="#绝对引入和相对引入" class="headerlink" title="绝对引入和相对引入"></a>绝对引入和相对引入</h2><p><code>import a</code>就是绝对引入，<code>from . import a</code>就是相对引入。也就是说带<code>.</code>的就是相对引入。</p></div><div class="story post-story"><h2 id="a-gt-d-gt-b（引用父文件）"><a href="#a-gt-d-gt-b（引用父文件）" class="headerlink" title="a -&gt; d -&gt; b（引用父文件）"></a>a -&gt; d -&gt; b（引用父文件）</h2><figure class="highlight python"><figcaption><span>python</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># a.py</span></span><br><span class="line"><span class="keyword">from</span> dir1 <span class="keyword">import</span> d</span><br><span class="line"><span class="comment"># d.py</span></span><br><span class="line"><span class="keyword">from</span> .. <span class="keyword">import</span> b</span><br><span class="line"><span class="comment">#正确写法 import b</span></span><br></pre></td></tr></table></figure><p>如果你这么写的话一定会报错的，Attempted relative import with no known parent package，不报错你也不会来看我的博客（）</p><p>这里假设<code>a.py</code>是运行入口文件，正确的写法是直接<code>import b</code>，这是因为<code>b.py</code>和<code>a.py</code>同级，也就是说如果是要引入同运行入口文件同级的<code>.py</code>，则直接<code>import</code>就可以。</p></div><div class="story post-story"><h2 id="a-gt-d-gt-x-gt-e（引用子文件后再引用其父文件）"><a href="#a-gt-d-gt-x-gt-e（引用子文件后再引用其父文件）" class="headerlink" title="a -&gt; d -&gt; x -&gt; e（引用子文件后再引用其父文件）"></a>a -&gt; d -&gt; x -&gt; e（引用子文件后再引用其父文件）</h2><p>这个在<code>d.py</code>中就是正常的<code>from .dir1 import x</code>，但是需要注意的是，在<code>x.py</code>中需要使用<code>from .. import e</code>，这和上面那个引用父文件的方法不一样，所以说一定要注意哪个才是运行入口文件！！</p></div><div class="story post-story"><h2 id="a-gt-d-gt-x-gt-c"><a href="#a-gt-d-gt-x-gt-c" class="headerlink" title="a -&gt; d -&gt; x -&gt; c"></a>a -&gt; d -&gt; x -&gt; c</h2><p>这里也出现了<code>a.py</code>引用同级的<code>c.py</code>的情况，与<code>x.py</code>引用<code>e.py</code>不同，<code>x.py</code>引用<code>c.py</code>的时候直接<code>import c</code>就可以。</p></div><div class="story post-story"><h2 id="a-gt-b-gt-c"><a href="#a-gt-b-gt-c" class="headerlink" title="a -&gt; b -&gt; c"></a>a -&gt; b -&gt; c</h2><p>最后这个也是同级，<code>import c</code>就可以。</p></div><div class="story post-story"><h2 id="在运行入口文件中引用其父文件"><a href="#在运行入口文件中引用其父文件" class="headerlink" title="在运行入口文件中引用其父文件"></a>在运行入口文件中引用其父文件</h2><p>不是不可以，其实没什么必要这么做，因为如果后续要继续改的话会频繁出错，例如如果存在另一个同级或非同级的文件，此文件要引用原来的运行入口文件，那么原运行入口文件所引用的文件很可能就引用失败。</p><p>所以我看有些库，例如<code>requests</code>，官方的<code>asyncio</code>都是只有一个层级，大家都是非运行入口文件，互相引用的时候都是用相对引入。</p><p>如果你真的要在运行入口文件中引用其父文件，那么这样写</p><figure class="highlight python"><figcaption><span>dir1/d.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</span><br><span class="line">sys.path(path.dirname(path.dirname(path.abspath(__file__))))</span><br><span class="line"><span class="keyword">import</span> a</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
    <summary type="html">在存在父子文件结构情况下使用python import，深刻理解python如何引import用子文件和父文件。Attempted relative import with no known parent package</summary>
    
    
    
    <category term="python学习笔记" scheme="https://xingpingcn.top/categories/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="python" scheme="https://xingpingcn.top/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>在python中运行bash实时输出结果（windows）</title>
    <link href="https://xingpingcn.top/%E5%9C%A8python%E4%B8%AD%E8%BF%90%E8%A1%8Cbash%EF%BC%88windows%EF%BC%89.html"/>
    <id>https://xingpingcn.top/%E5%9C%A8python%E4%B8%AD%E8%BF%90%E8%A1%8Cbash%EF%BC%88windows%EF%BC%89.html</id>
    <published>2024-03-11T15:59:52.610Z</published>
    <updated>2024-03-28T15:02:25.243Z</updated>
    
    <content type="html"><![CDATA[<p>在windows的cmd中是不能运行bash的，我们需要利用git工具的bash来运行，但是用subprocess.run()会出问题，例如不能使用已经添加到环境变量的命令，如nvm、adb等；因此改用subprocess.Popen()</p><span id="more"></span><div class="story post-story"><h2 id="批量输入并且最后输出所有结果"><a href="#批量输入并且最后输出所有结果" class="headerlink" title="批量输入并且最后输出所有结果"></a>批量输入并且最后输出所有结果</h2><p><code>bash_path</code>用于定位你的git工具的<code>bash</code>，参数<code>cwd=</code>用于定位你的工作目录，和在文件夹中右键<code>git bash here</code>是一样的效果。</p><p>输入的命令可以带有空格，但是必须在最后加上<code>\n</code></p><figure class="highlight python"><figcaption><span>example-1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line">bash_path = <span class="string">r&#x27;F:\Program Files\Git\bin\bash.exe&#x27;</span></span><br><span class="line">subp = subprocess.Popen(bash_path,stdin=subprocess.PIPE,stdout=subprocess.PIPE,stderr=subprocess.PIPE,encoding=<span class="string">&#x27;utf8&#x27;</span>,cwd=<span class="string">&#x27;$your_path&#x27;</span>)</span><br><span class="line"><span class="comment">#输入的命令可以带有空格，但是必须在最后加上`\n`</span></span><br><span class="line">subp.stdin.write(<span class="string">&#x27;nvm -v\n&#x27;</span>)</span><br><span class="line">subp.stdin.flush()</span><br><span class="line">subp.stdin.write(<span class="string">&#x27;nvm -v\n&#x27;</span>)</span><br><span class="line">subp.stdin.flush()</span><br><span class="line">subp.stdin.write(<span class="string">&#x27;nvm -v\n&#x27;</span>)</span><br><span class="line">subp.stdin.flush()</span><br><span class="line"><span class="comment">#不要忘记了关闭subp，否则会阻塞</span></span><br><span class="line">subp.stdin.close()</span><br><span class="line"><span class="built_in">print</span>(subp.stdout.read())</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>output</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.1</span><span class="number">.11</span></span><br><span class="line"><span class="number">1.1</span><span class="number">.11</span></span><br><span class="line"><span class="number">1.1</span><span class="number">.11</span></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="实时输入并输出结果"><a href="#实时输入并输出结果" class="headerlink" title="实时输入并输出结果"></a>实时输入并输出结果</h2><p>需要用到多线程<code>threading</code>和队列<code>queue</code>来实时获取输出结果。最后也不要忘记调用子进程的<code>close()</code>方法。</p><figure class="highlight python"><figcaption><span>example-2</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">import</span> threading,time</span><br><span class="line"></span><br><span class="line">bash_path = <span class="string">r&#x27;F:\Program Files\Git\bin\bash.exe&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">thread_for_listen</span>(<span class="params">subp,q</span>):</span><br><span class="line">   <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">iter</span>(subp.stdout.readline,<span class="string">&#x27;&#x27;</span>):</span><br><span class="line">      q.put(line)</span><br><span class="line">subp = subprocess.Popen(bash_path,stdin=subprocess.PIPE,stdout=subprocess.PIPE,stderr=subprocess.PIPE,encoding=<span class="string">&#x27;utf8&#x27;</span>,cwd=<span class="string">&#x27;./public&#x27;</span>)</span><br><span class="line">q = queue.Queue()</span><br><span class="line">p1 = threading.Thread(target =thread_for_listen,args=(subp,q))</span><br><span class="line"></span><br><span class="line">p1.start()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">   subp.stdin.write(<span class="string">&#x27;nvm -v\n&#x27;</span>)</span><br><span class="line">   subp.stdin.flush()</span><br><span class="line">   <span class="built_in">print</span>(q.get(),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">   time.sleep(<span class="number">0.3</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;wake up after 0.3s&#x27;</span>)</span><br><span class="line">subp.stdin.close()</span><br><span class="line">q.task_done()</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>output</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.1</span><span class="number">.11</span></span><br><span class="line">wake up after <span class="number">0.3</span>s</span><br><span class="line"><span class="number">1.1</span><span class="number">.11</span></span><br><span class="line">wake up after <span class="number">0.3</span>s</span><br><span class="line"><span class="number">1.1</span><span class="number">.11</span></span><br><span class="line">wake up after <span class="number">0.3</span>s</span><br><span class="line"><span class="number">1.1</span><span class="number">.11</span></span><br><span class="line">wake up after <span class="number">0.3</span>s</span><br><span class="line"><span class="number">1.1</span><span class="number">.11</span></span><br><span class="line">wake up after <span class="number">0.3</span>s</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
    <summary type="html">在windows系统下的python中使用环境变量运行bash</summary>
    
    
    
    <category term="python学习笔记" scheme="https://xingpingcn.top/categories/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="python" scheme="https://xingpingcn.top/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>使用freecdn-js提高hexo博客的cdn稳定性（接入透明模式）</title>
    <link href="https://xingpingcn.top/%E4%BD%BF%E7%94%A8freecdn-js%E6%8F%90%E9%AB%98hexo%E5%8D%9A%E5%AE%A2%E7%9A%84cdn%E7%A8%B3%E5%AE%9A%E6%80%A7.html"/>
    <id>https://xingpingcn.top/%E4%BD%BF%E7%94%A8freecdn-js%E6%8F%90%E9%AB%98hexo%E5%8D%9A%E5%AE%A2%E7%9A%84cdn%E7%A8%B3%E5%AE%9A%E6%80%A7.html</id>
    <published>2024-03-11T15:59:52.609Z</published>
    <updated>2024-03-28T15:02:19.499Z</updated>
    
    <content type="html"><![CDATA[<p>由于<code>cdn.jsdelivr.net</code>在国内不太稳定，替代的<code>jsd.cdn.zzko.cn</code>稳定性稍好，但是也不是100%稳定，因而需要一个脚本实时切换到合适的CDN。<a href="https://github.com/EtherDream/freecdn" target="_blank" rel="noopener external nofollow noreferrer">freecdn-js</a>能实现这个需求。freecdn-js是纯前端的，使用<code>service worker</code>，只需要插入一段<code>js</code>代码就可以，因此改造成本很低。但是我的文件（图片、js等）储存在GitHub图床，而<code>freecdn-js</code>本身需要被加速的文件的<code>hash</code>值，因此需要自己写脚本处理下载图片并计算。因为图片等文件的cdn链接是直接写在<code>.md</code>文件中的，所以写了一个正则脚本来提取cdn的链接。</p><span id="more"></span><div class="story post-story"><h2 id="脚本使用方法"><a href="#脚本使用方法" class="headerlink" title="脚本使用方法"></a>脚本使用方法</h2><div class="tag link"><a class="link-card" title="cdn链接处理脚本" href="https://github.com/xingpingcn/picture-bed-using-freecdn"><div class="left"><img src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">cdn链接处理脚本</p><p class="url">https://github.com/xingpingcn/picture-bed-using-freecdn</p></div></a></div><p>我写的脚本发布在GitHub上，匹配了<code>![img](url)</code>、<code>&#123;%link%&#125;</code>、<code>&#123;%image%&#125;</code>、<code>headimg</code>四个<code>tag</code>。脚本请到GitHub下载。</p><p>可以屏蔽相关<code>cdn</code>（更改host或用v2rayN路由屏蔽）测试<code>freecdn-js</code>是否能切换备用cdn。</p><p>扩展教程在这里：<a href="https://xingpingcn.top/npm%E5%9B%BE%E5%BA%8A%EF%BC%88%E4%B8%8D%E9%9C%80%E8%A6%81%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%EF%BC%89.html">使用npm空间存放图片和html并利用cdn加速</a></p><p>需要的包版本</p><figure class="highlight json"><figcaption><span>package version</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">urllib3   <span class="number">1.25</span><span class="number">.11</span></span><br><span class="line">nodejs    <span class="number">16.10</span><span class="number">.0</span></span><br><span class="line">freecdn   <span class="number">0.3</span><span class="number">.1</span></span><br></pre></td></tr></table></figure><div class="note info"><p>以下引用GitHub上的README.md文件</p></div><div class="tag link"><a class="link-card" title="README.md" href="https://github.com/xingpingcn/picture-bed-using-freecdn"><div class="left"><img src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">README.md</p><p class="url">https://github.com/xingpingcn/picture-bed-using-freecdn</p></div></a></div></div><div class="story post-story"><h2 id="Windows的大坑！"><a href="#Windows的大坑！" class="headerlink" title="Windows的大坑！"></a>Windows的大坑！</h2><div class="note warning red"><p>此为大坑！务必阅读</p></div><p>如果利用Windows来写博客，那么提交<code>git</code>的时候会出现<code>LF will be replaced by CRLF the next time Git touches it</code>的提示，<code>CR</code>（回车）就是<code>\r</code>，<code>LF</code>（换行）就是<code>\n</code>，Windows平台默认换行符就是<code>CRLF</code>(<code>\r\n</code>)，此变换会导致本地文件的<code>hash</code>和存放在npm或者git空间的文件的<code>hash</code>不一致；需要运行以下命令行:</p><figure class="highlight bash"><figcaption><span>BASH</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#提交检出均不转换</span></span><br><span class="line">git config --global core.autocrlf <span class="literal">false</span></span><br></pre></td></tr></table></figure><div class="note info"><p>适用于Windows系统，且只在Windows上开发的情况。在提交、检出时不会对<code>CRLF</code>&#x2F;<code>LF</code>换行符进行转换</p></div></div><div class="story post-story"><h2 id="接入透明模式【可选】"><a href="#接入透明模式【可选】" class="headerlink" title="接入透明模式【可选】"></a>接入透明模式【可选】</h2><div class="note warning"><p><strong>建议暂时不配置</strong></p><p>经过一段时间的观察，透明模式会起到严重的“减速”作用，FCP延后非常多。<br>本来想试试http2服务器一次性推送freecdn.js和相关的txt的，结果发现<code>chrome</code>从106版本就不支持http2服务器推送了。谷歌给出的替代方案是使用<code>103 early hints</code>，但是<code>nginx</code>现在还不支持。谷歌给出的另一个代替方案是传统的<code>link rel=preload</code>。<code>link rel=preload</code>确实可以在一次性推送freecdn.js和相关的txt，但是在安装了<code>Service Worker</code>之后依然会再次加载freecdn.js和相关的txt，结果就是速度没变，流量还浪费不少。又或者是我设置的问题，，，</p></div><h3 id="配置透明模式"><a href="#配置透明模式" class="headerlink" title="配置透明模式"></a>配置透明模式</h3><p>freecdn透明模式的优势和<code>配置文件</code>看下面的链接</p><div class="tag link"><a class="link-card" title="freecdn透明模式" href="https://github.com/EtherDream/freecdn/tree/master/docs/transparent-mode"><div class="left"><img src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">freecdn透明模式</p><p class="url">https://github.com/EtherDream/freecdn/tree/master/docs/transparent-mode</p></div></a></div><p>博客使用<a href="https://render.com/" target="_blank" rel="noopener external nofollow noreferrer">render.com</a>托管静态资源；因为freecdn的透明模式仅仅提供了<code>nginx</code>配置，而且<code>render</code>刚刚好也支持<code>docker</code>，那就直接用<a href="https://hub.docker.com/_/nginx" target="_blank" rel="noopener external nofollow noreferrer">nginx-docker</a>吧。</p><div class="note done"><p>render.com免费提供每月100g流量、750小时实例时间、500min构建时间、0.1<code>cpu</code>和512m<code>RAM</code></p></div><div class="note warning"><p>Render spins down a Free web service that goes 15 minutes without receiving inbound traffic. Render spins the service back up whenever it next receives a request to process.<a href="https://render.com/docs/free#spinning-down-on-idle" target="_blank" rel="noopener external nofollow noreferrer">Learn more</a></p></div><p>首先在你的博客根目录下的<code>source</code>创建<code>Dockerfile</code>文件。（生成博客的时候会把<code>source</code>内的文件移动到将要被上传到repo的文件夹内）</p><figure class="highlight plaintext"><figcaption><span>./source/Dockerfile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM nginx</span><br><span class="line">COPY ./ /usr/share/nginx/html</span><br><span class="line">COPY ./freecdn-boot.conf /etc/nginx</span><br><span class="line">COPY ./nginx.conf /etc/nginx/nginx.conf</span><br><span class="line">EXPOSE 443</span><br></pre></td></tr></table></figure><p>然后下载freecdn的两个<code>配置文件</code>，<code>freecdn-boot.conf</code>和<code>nginx.conf</code>，同样放在博客根目录，只需要改动<code>nginx.conf</code>。</p><figure class="highlight plaintext"><figcaption><span>./source/nginx.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">  worker_connections      1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">  server &#123;</span><br><span class="line">    # freecdn nginx conf</span><br><span class="line">    include freecdn-boot.conf;</span><br><span class="line"></span><br><span class="line">    root                  /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">    expires               1h;</span><br><span class="line">    default_type          text/plain;</span><br><span class="line">    include               mime.types;</span><br><span class="line"></span><br><span class="line">    # HTTPS conf</span><br><span class="line">    listen                443;</span><br><span class="line"></span><br><span class="line">    location /works &#123;</span><br><span class="line">      return              200  &quot;it works&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    gzip                  on;</span><br><span class="line">    gzip_static           on;</span><br><span class="line">    gzip_types</span><br><span class="line">      text/plain</span><br><span class="line">      text/xml</span><br><span class="line">      text/javascript</span><br><span class="line">      text/css</span><br><span class="line">      application/x-javascript</span><br><span class="line">      application/json</span><br><span class="line">      application/xml</span><br><span class="line">      application/xml+rss</span><br><span class="line">    ;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>br和gzip压缩在render平台自动开启，见官网<a href="https://render.com/docs/native-runtimes" target="_blank" rel="noopener external nofollow noreferrer">docs</a>。</p><p>上传到GitHub reop（hexo d）后，在render.com创建一个<code>web service</code>，然后选择你的repo部署就可以了。</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231009/image.5xld6kv7rco0.png' data-fancybox='default' data-caption='render.com' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 97.01230228471002%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231009/image.5xld6kv7rco0.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231009/image.5xld6kv7rco0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="render.com" loading="lazy">            </a><span class='image-caption'>render.com</span></div></div><h3 id="白嫖到底！"><a href="#白嫖到底！" class="headerlink" title="白嫖到底！"></a>白嫖到底！</h3><p>由于免费的render web service会在15分钟之内没有连接访问的情况下断开，并在下一次访问之后重启启动，而重新启动需要较长时间；因此用cf worker去定时访问网站。</p><p>需要一个cf账号，没有的先去<a href="https://dash.cloudflare.com/" target="_blank" rel="noopener external nofollow noreferrer">注册</a></p><p>点击左侧的<code>worker and page</code>，创建一个worker，这个时候不能改动代码，先确认创建。之后点击<code>触发器</code>标签，并找到<code>Cron 触发器</code>，填入<code>3/13 * * * *</code>，这行代码表示在每个小时过3分钟之后触发一次定时器，然后每过13分钟再触发一次（如果和<code>每个小时过3分钟</code>这一条件冲突，则重置触发器，即在每个小时过3分钟之后再次触发，如此反复）。设置效果如下图所示</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231010/image.39t23jxed3q0.png' data-fancybox='default' data-caption='image' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 17.526315789473685%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231010/image.39t23jxed3q0.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231010/image.39t23jxed3q0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image" loading="lazy">            </a><span></span></div></div><p>之后编辑worker。点击<code>快速编辑</code>，写入以下代码</p><figure class="highlight js"><figcaption><span>./worker.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">scheduled</span>(<span class="params">event, env, ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;https://xxx.com/favicon.ico&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> data = res.<span class="title function_">json</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>async scheduled</code>表时当触发器触发时运行代码（题外话：这是不是可以当作一个免费的攻击服务器？？），<code>fetch</code>代表访问你的网站的资源，<code>await</code>似乎是必需的，因为没有<code>await</code>的话在render的log里面看不到<code>worker</code>的访问记录。</p></div>]]></content>
    
    
    <summary type="html">根据md文件内的cdn链接（图片等并不在本地）自动生成cdn列表，若图片、js、html等文件cdn失效则尝试连接列表内的其他cdn，并接入透明模式</summary>
    
    
    
    <category term="hexo折腾" scheme="https://xingpingcn.top/categories/hexo%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="volantis" scheme="https://xingpingcn.top/tags/volantis/"/>
    
  </entry>
  
  <entry>
    <title>免费通过NS1利用监控宝平台实现实时基于不同运营商的故障转移</title>
    <link href="https://xingpingcn.top/%E5%85%8D%E8%B4%B9%E9%80%9A%E8%BF%87ns1%E5%88%A9%E7%94%A8%E7%9B%91%E6%8E%A7%E5%AE%9D%E5%B9%B3%E5%8F%B0%E5%AE%9E%E7%8E%B0%E5%AE%9E%E6%97%B6%E5%9F%BA%E4%BA%8E%E4%B8%8D%E5%90%8C%E8%BF%90%E8%90%A5%E5%95%86%E7%9A%84%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB.html"/>
    <id>https://xingpingcn.top/%E5%85%8D%E8%B4%B9%E9%80%9A%E8%BF%87ns1%E5%88%A9%E7%94%A8%E7%9B%91%E6%8E%A7%E5%AE%9D%E5%B9%B3%E5%8F%B0%E5%AE%9E%E7%8E%B0%E5%AE%9E%E6%97%B6%E5%9F%BA%E4%BA%8E%E4%B8%8D%E5%90%8C%E8%BF%90%E8%90%A5%E5%95%86%E7%9A%84%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB.html</id>
    <published>2024-03-11T15:59:52.609Z</published>
    <updated>2024-05-27T15:57:55.895Z</updated>
    
    <content type="html"><![CDATA[<p>本教程用到的资源全部都是免费且可持续使用的。NS1.com这个权威DNS服务器能根据ASN、国家或省份、DNS轮询（可加权）等方式解析域名，并且提供了API去控制某个解析（answer）是否响应。监控宝能实时监控网站（通过HTTP、PING、DNS方式等）并输出警告（webhook、Email、短信等），最高监控频率为2分钟。亚马逊的AWS Lambda是一个FaaS平台（serverless），可以作为连接NS1.com和监控宝之间的桥梁，当监控宝检测到网站速度变慢的时候发送信息到AWS Lambda，AWS Lambda得到信息后再传递给NS1.com，速度恢复的时候也是同样的操作。为什么要夹在一个AWS Lambda呢？这是因为监控宝发送的格式是固定的，并不能直接接入到NS1.com。</p><span id="more"></span><div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>需要用到的工具和技能有：</p><div class="note info"><p><strong>工具和技能</strong></p><ul><li><p><a href="https://ns1.com/" target="_blank" rel="noopener external nofollow noreferrer">NS1.com</a>。免费一个<a href="https://help.ns1.com/hc/en-us/articles/360020683013-About-the-NS1-Filter-Chain" target="_blank" rel="noopener external nofollow noreferrer">Filter Chain</a>。Filter Chain就是根据不同条件进行响应的工具。</p></li><li><p><a href="https://www.cloudwise.sg/en/synthetic/" target="_blank" rel="noopener external nofollow noreferrer">监控宝国际版</a>。国际版可以用中国大陆和海外的手机号注册，同样可以用国内电信、移动、联通、教育网的监控节点。免费5个网站监控。</p></li><li><p><a href="https://aws.amazon.com/cn/lambda/getting-started/" target="_blank" rel="noopener external nofollow noreferrer">AWS Lambda</a>。注册使用可能需要visa银行卡或其他银行卡验证。每月一百万次调用。</p></li><li><p>一点点耐心。</p></li><li><p>一点点点python技术。</p></li></ul></div></div><div class="story post-story"><h2 id="NS1-com使用教程"><a href="#NS1-com使用教程" class="headerlink" title="NS1.com使用教程"></a>NS1.com使用教程</h2><h3 id="Filter-Chain的使用"><a href="#Filter-Chain的使用" class="headerlink" title="Filter Chain的使用"></a>Filter Chain的使用</h3><div class="tag link"><a class="link-card" title="NS1.COM官方文档|Filter Chain使用示例" href="https://help.ns1.com/hc/en-us/articles/360020683013"><div class="left"><img src="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">NS1.COM官方文档|Filter Chain使用示例</p><p class="url">https://help.ns1.com/hc/en-us/articles/360020683013</p></div></a></div><p>顾名思义就是不断地过滤不符合条件的answer，直到链（Chain）的结尾就是要返回给用户的解析结果。</p><div class="note warning"><p>因此每个过滤器的顺序十分重要（这一点官方文档写到比较隐晦，但是十分重要）</p></div><p>一般而言，以<code>Up</code>开头，<code>Select First N</code>结尾。前者代表是否开启该<code>answer</code>，我们使用监控包如果发现网站速度过慢则可以设置为<code>Up: False</code>；后者表示假如链（Chain）的结尾有多个<code>answer</code>，则返回前N个<code>answer</code>，默认N为1。可以通过调整<code>Priority</code>调整优先级。</p><p>这是我的设置</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.2w3ghwje0lw0.webp' data-fancybox='default' data-caption='Filter Chain' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 114.04682274247492%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.2w3ghwje0lw0.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.2w3ghwje0lw0.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Filter Chain" loading="lazy">            </a><span class='image-caption'>Filter Chain</span></div></div><div class="note done"><p>建议勾选对应的复选框。因为每个人的设置不一样，请仔细阅读说明决定是否勾选！</p></div><p>之后我们要根据不同的运营商或者国家地区来返回DNS解析结果。因为NS1没有提供国内运营商的分类，但是提供了<code>ASN</code>来分类。我写了个爬虫小脚本，爬取不同运营商的<code>ASN</code>，使用以下这个项目获取，然后填入到对应区域。</p><div class="tag link"><a class="link-card" title="中国大陆ASN" href="https://github.com/xingpingcn/china-mainland-asn"><div class="left"><img src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">中国大陆ASN</p><p class="url">https://github.com/xingpingcn/china-mainland-asn</p></div></a></div><p>我是创建了<code>answer group</code>来分类不同的运营商的。</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.6tza0wmi6k40.webp' data-fancybox='default' data-caption='answer设置' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 48.802083333333336%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.6tza0wmi6k40.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.6tza0wmi6k40.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="answer设置" loading="lazy">            </a><span class='image-caption'>answer设置</span></div></div><p>你也可以使用自动化工具来定时更新<code>ASN</code>。使用到的工具有<code>aws lambda</code>（下文有介绍）和<code>aws cloud bridge</code>的定时器（需自行配置），例如每隔10更新一次。</p><figure class="highlight python"><figcaption><span>python</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># key为你的ns1 feed label；value为下载asn列表用到的url的一部分，一般情况下不需要修改</span></span><br><span class="line">asn_dict = &#123;</span><br><span class="line">    <span class="string">&#x27;dianxin&#x27;</span>:<span class="string">&#x27;chinanet&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;yidong&#x27;</span>:<span class="string">&#x27;cmcc&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;liantong&#x27;</span>:<span class="string">&#x27;unicom&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ns1_api_key = <span class="string">&#x27;&#x27;</span></span><br><span class="line">source_id = <span class="string">&#x27;&#x27;</span></span><br><span class="line">ns1_req_url = <span class="string">f&#x27;https://api.nsone.net/v1/feed/<span class="subst">&#123;source_id&#125;</span>&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;X-NSONE-Key&quot;</span>:<span class="string">f&quot;<span class="subst">&#123;ns1_api_key&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ns1_asn_label, gh_asn <span class="keyword">in</span> asn_dict.items():</span><br><span class="line">    url_to_down = <span class="string">f&#x27;https://raw.githubusercontent.com/xingpingcn/china-mainland-asn/main/asn_txt/<span class="subst">&#123;gh_asn&#125;</span>.txt&#x27;</span></span><br><span class="line">    response = requests.get(url_to_down).text</span><br><span class="line">    asn_list_from_gh = response.split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">f&quot;<span class="subst">&#123;ns1_asn_label&#125;</span>&quot;</span>:&#123;<span class="string">&quot;asn&quot;</span>:asn_list_from_gh&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(ns1_req_url,headers=headers,json=data)</span><br><span class="line">    <span class="built_in">print</span>(res.status_code)</span><br></pre></td></tr></table></figure><p>之后可以选择<code>country</code>为<code>CN</code>的<code>answer</code>作为未命中规则的备选。之后再填写一个只有<code>Up</code>的<code>answer</code>作为除中国之外全球的DNS解析结果。</p><div class="note warning red"><p><strong>强烈建议</strong></p><p>如果你使用<code>render</code>、<code>railway</code>、<code>cf</code>、<code>cyclic</code>、<code>zeabur</code>等托管你的网站，除中国之外全球的DNS解析结果是必须配置的，此设置用于ssl证书的申请。建议设置为加权的DNS轮询（此方法似乎对于<code>netlify</code>有点水土不服，因为只要DNS没解析到<code>netlify</code>就暂停ssl证书。其他的只要认证了网站就可以用一段时间，一般是3个月，下一个3个月会重新申请，认证一次不过会自动重试几次；成功一次就可以继续用3个月）</p></div><div class="note info"><p>建议国内少用<code>country</code>，因为不太准</p></div><h3 id="NS1-API的使用"><a href="#NS1-API的使用" class="headerlink" title="NS1 API的使用"></a>NS1 API的使用</h3><h4 id="设置DNS"><a href="#设置DNS" class="headerlink" title="设置DNS"></a>设置DNS</h4><div class="tag link"><a class="link-card" title="NS1.COM官方文档|NS1 data feed创建" href="https://help.ns1.com/hc/en-us/articles/360020474154-Create-a-data-feed"><div class="left"><img src="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">NS1.COM官方文档|NS1 data feed创建</p><p class="url">https://help.ns1.com/hc/en-us/articles/360020474154-Create-a-data-feed</p></div></a></div><p>根据图的指引创建<code>data source</code>和<code>data feed</code>。详细看官方文档。</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.6kam8770lhc0.webp' data-fancybox='default' data-caption='NS1 API的使用' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 46.90889370932755%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.6kam8770lhc0.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.6kam8770lhc0.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="NS1 API的使用" loading="lazy">            </a><span class='image-caption'>NS1 API的使用</span></div></div><p>可以看到上面的图，在<code>answer</code>里已经设置好了关联的<code>data feed</code>了（绿色箭头表示开启，红色表示关闭）；先关联，之后我们会通过<code>AWS Lambda</code>来控制的。关联的<code>data feed</code>详细操作看官方文档。</p><div class="tag link"><a class="link-card" title="NS1.COM官方文档|answer关联data feed" href="https://help.ns1.com/hc/en-us/articles/360020471154-Automatic-failover"><div class="left"><img src="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">NS1.COM官方文档|answer关联data feed</p><p class="url">https://help.ns1.com/hc/en-us/articles/360020471154-Automatic-failover</p></div></a></div><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.6ezli28bbhw0.webp' data-fancybox='default' data-caption='answer关联data feed' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 76.25383828045035%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.6ezli28bbhw0.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.6ezli28bbhw0.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="answer关联data feed" loading="lazy">            </a><span class='image-caption'>answer关联data feed</span></div></div><h4 id="编写feed更改请求-python"><a href="#编写feed更改请求-python" class="headerlink" title="编写feed更改请求-python"></a>编写feed更改请求-python</h4><div class="tag link"><a class="link-card" title="NS1 API官方文档|修改data feed" href="https://ns1.com/api?docId=2188"><div class="left"><img src="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">NS1 API官方文档|修改data feed</p><p class="url">https://ns1.com/api?docId=2188</p></div></a></div><p>我们可以编写python以请求<code>API</code>来更改<code>UP</code>的状态。之后我们会把代码放到<code>AWS Lambda</code>来控制的。</p><p>注意填写必要的信息。</p><div class="note yellow"><p><strong>参数设置</strong></p><ul><li><code>status</code>为<code>True</code>是开启，<code>False</code>是关闭。</li><li><code>source_id</code>和<code>label</code>就是上面图中提到要记住的内容。</li><li><code>ns1_api_key</code>需要自己到设置里申请。建议只开启必要的权限。<div class="note done"><p><strong>设置`KEY`</strong></p><p>点击右上角的<code>settings</code>里的<code>users&amp;teams</code></p></div></li></ul></div><figure class="highlight python"><figcaption><span>python</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">status = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">source_id = <span class="string">&#x27;&#x27;</span></span><br><span class="line">label=<span class="string">&#x27;&#x27;</span></span><br><span class="line">ns1_api_key = <span class="string">&#x27;&#x27;</span></span><br><span class="line">url = <span class="string">f&#x27;https://api.nsone.net/v1/feed/<span class="subst">&#123;source_id&#125;</span>&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;X-NSONE-Key&quot;</span>:<span class="string">f&quot;<span class="subst">&#123;ns1_api_key&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">f&quot;<span class="subst">&#123;label&#125;</span>&quot;</span>:&#123;<span class="string">&quot;up&quot;</span>:status&#125;</span><br><span class="line">&#125;</span><br><span class="line">res = requests.post(url,headers=headers,json=data)</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="使用AWS-Lambda"><a href="#使用AWS-Lambda" class="headerlink" title="使用AWS Lambda"></a>使用AWS Lambda</h2><p><code>AWS Lambda</code>支持python且可以通过各种条件来触发，现在我们用监控平台（本教程用的监控宝）的<code>webhook</code>来触发，发送<code>POST</code>请求到<code>NS1</code>来更新<code>answer</code>状态。</p><h3 id="创建函数"><a href="#创建函数" class="headerlink" title="创建函数"></a>创建函数</h3><p>点击创建函数——填写信息——点击高级设置</p><div class="note warning"><p>授权类型选<code>NONE</code>，勾选配置跨源资源共享(CORS)</p></div><div class="tag link"><a class="link-card" title="监控宝官方文档|回调url实例" href="https://help.cloudwise.com/help/38/39/520"><div class="left"><img src="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">监控宝官方文档|回调url实例</p><p class="url">https://help.cloudwise.com/help/38/39/520</p></div></a></div><p>如果里选择使用监控宝，那么填入以下代码 ↓</p><div class="note yellow"><p><strong>参数设置</strong></p><p><code>url_token</code>填写监控宝里回调url里的<code>回调token</code>。如果没有监控宝还没有设置，不要紧回来再弄。<br>其他参数请看<a href="#%E7%BC%96%E5%86%99feed%E6%9B%B4%E6%94%B9%E8%AF%B7%E6%B1%82-python">这里</a><br>其中<code>status</code>会根据监控宝的状态自动设置。</p></div><figure class="highlight python"><figcaption><span>python</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">source_id = <span class="string">&#x27;&#x27;</span></span><br><span class="line">label=<span class="string">&#x27;&#x27;</span></span><br><span class="line">status = <span class="literal">True</span></span><br><span class="line">ns1_api_key = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">url_token = <span class="string">&#x27;&#x27;</span> <span class="comment">#回调token</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_md5</span>(<span class="params">content</span>):</span><br><span class="line">    md5hash = hashlib.md5(content)</span><br><span class="line">    md5 = md5hash.hexdigest()</span><br><span class="line">    <span class="keyword">return</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lambda_handler</span>(<span class="params">event, context</span>):</span><br><span class="line">    json_data = json.loads(event[<span class="string">&#x27;body&#x27;</span>])</span><br><span class="line">    verify = <span class="built_in">str</span>(json_data[<span class="string">&#x27;msg_id&#x27;</span>])+<span class="built_in">str</span>(json_data[<span class="string">&#x27;task_id&#x27;</span>])+<span class="built_in">str</span>(json_data[<span class="string">&#x27;fault_time&#x27;</span>])+url_token</span><br><span class="line">    md5 = g_md5(verify.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> md5==json_data[<span class="string">&#x27;token&#x27;</span>]:</span><br><span class="line">        <span class="keyword">if</span> json_data[<span class="string">&#x27;message_status&#x27;</span>] == <span class="number">1</span> <span class="keyword">or</span> json_data[<span class="string">&#x27;message_status&#x27;</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            status = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> json_data[<span class="string">&#x27;message_status&#x27;</span>] == <span class="number">2</span> <span class="keyword">or</span> json_data[<span class="string">&#x27;message_status&#x27;</span>] == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            status = <span class="literal">True</span></span><br><span class="line">        url = <span class="string">f&#x27;https://api.nsone.net/v1/feed/<span class="subst">&#123;source_id&#125;</span>&#x27;</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&quot;X-NSONE-Key&quot;</span>:<span class="string">f&quot;<span class="subst">&#123;ns1_api_key&#125;</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        data = &#123;</span><br><span class="line">        <span class="string">f&quot;<span class="subst">&#123;label&#125;</span>&quot;</span>:&#123;<span class="string">&quot;up&quot;</span>:status&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url,headers=headers,json=data)</span><br><span class="line">        <span class="built_in">print</span>(res.text,<span class="string">f&#x27;[status] \&#x27;up\&#x27;: <span class="subst">&#123;status&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><div class="note done"><p>这里不得不吐槽一句监控宝，<code>回调url</code>设置中的测试发送的json和实际应用中发送的json不一样的，如果发现测试报错请使用正常监控方式来测试</p></div><div class="note warning"><p>记得点击<code>deploy</code>！</p></div><h3 id="设置层（layers）"><a href="#设置层（layers）" class="headerlink" title="设置层（layers）"></a>设置层（layers）</h3><p>因为<code>AWS Lambda</code>默认不能使用第三方库，因为用到了<code>requests</code>库，所以要自己上传<code>requests</code>库。或者你也可以自己用python原生库重写。</p><div class="tag link"><a class="link-card" title="AWS官方文档|为依赖项创建Python层" href="https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/python-package.html#python-package-dependencies-layers"><div class="left"><img src="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">AWS官方文档|为依赖项创建Python层</p><p class="url">https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/python-package.html#python-package-dependencies-layers</p></div></a></div><p><code>requests.zip</code>可以根据官方文档自己生成，也可以上传我制作的<code>requests.zip</code></p><div class="note download blue"><p><a href="https://jsd.cdn.zzko.cn/gh/xingpingcn/website.comments@main/requests.zip" target="_blank" rel="noopener external nofollow noreferrer">下载</a>|<a href="https://github.com/xingpingcn/website.comments/raw/main/requests.zip" target="_blank" rel="noopener external nofollow noreferrer">下载-GitHub</a>|<a href="https://cdn.jsdelivr.us/gh/xingpingcn/website.comments@main/requests.zip" target="_blank" rel="noopener external nofollow noreferrer">下载-备用</a></p></div><p>之后设置函数的<code>层</code>（layers），选择我们上传的<code>requests.zip</code>包。</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.49csmacgss80.webp' data-fancybox='default' data-caption='image' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 35.60673162090345%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.49csmacgss80.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.49csmacgss80.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image" loading="lazy">            </a><span></span></div></div></div><div class="story post-story"><h2 id="使用监控平台"><a href="#使用监控平台" class="headerlink" title="使用监控平台"></a>使用监控平台</h2><p>类似的平台还有观测云，免费版最高30分钟的检测频率，20万次访问每天好像是，节点11个，3网都有。</p><p>或者可以破解一些免费测速网站的js。</p><div class="note warning red"><p><strong>warning</strong></p><p>监控宝似乎在14天试用期之后直接封我号了，发两份邮件也不回，建议改用<code>观测云</code>，配置都是差不多的。</p></div><h3 id="监控宝"><a href="#监控宝" class="headerlink" title="监控宝"></a>监控宝</h3><details> <summary>点击查看，但是不建议</summary><p>监控宝可以使用回调url（webhook）来传递信息，设置如下图。</p><p><code>回调url</code>就填写<code>AWS Lambda</code>提供的url</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.qlhazjpj16o.webp' data-fancybox='default' data-caption='AWS Lambda' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 39.85239852398524%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.qlhazjpj16o.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.qlhazjpj16o.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="AWS Lambda" loading="lazy">            </a><span class='image-caption'>AWS Lambda</span></div><br><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.4iyi2poeafq0.webp' data-fancybox='default' data-caption='回调url' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 43.393393393393396%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.4iyi2poeafq0.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231027/image.4iyi2poeafq0.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="回调url" loading="lazy">            </a><span class='image-caption'>回调url</span></div></div><p>之后创建监控任务，记得在<code>Webhook通知</code>那里选择你的回调url。</p><div class="tag link"><a class="link-card" title="监控宝官方文档|回调url实例" href="https://help.cloudwise.com/help/38/39/520"><div class="left"><img src="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/npm/volantis-static@0.0.1654736714924/media/org.volantis/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">监控宝官方文档|回调url实例</p><p class="url">https://help.cloudwise.com/help/38/39/520</p></div></a></div></details><h3 id="观测云"><a href="#观测云" class="headerlink" title="观测云"></a>观测云</h3><p><code>aws lambda</code>填入以下代码</p><figure class="highlight python"><figcaption><span>python</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">source_id = <span class="string">&#x27;&#x27;</span></span><br><span class="line">ns1_api_key = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lambda_handler</span>(<span class="params">event, context</span>):</span><br><span class="line">    <span class="comment"># print(event,type(event))</span></span><br><span class="line">    json_data = json.loads(event[<span class="string">&#x27;body&#x27;</span>])</span><br><span class="line">    <span class="keyword">if</span> json_data[<span class="string">&#x27;isp&#x27;</span>]  == <span class="string">&#x27;telecom&#x27;</span>:</span><br><span class="line">        label = <span class="string">&#x27;dianxin&#x27;</span> <span class="comment"># ns1的feed label，下同</span></span><br><span class="line">    <span class="keyword">elif</span> json_data[<span class="string">&#x27;isp&#x27;</span>]  == <span class="string">&#x27;unicom&#x27;</span>:</span><br><span class="line">        label = <span class="string">&#x27;liantong&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> json_data[<span class="string">&#x27;isp&#x27;</span>]  == <span class="string">&#x27;cmcc&#x27;</span>:</span><br><span class="line">        label = <span class="string">&#x27;yidong&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> json_data[<span class="string">&#x27;df_status&#x27;</span>] == <span class="string">&#x27;critical&#x27;</span>:</span><br><span class="line">        status = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        status = <span class="literal">True</span></span><br><span class="line">    url = <span class="string">f&#x27;https://api.nsone.net/v1/feed/<span class="subst">&#123;source_id&#125;</span>&#x27;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;X-NSONE-Key&quot;</span>:<span class="string">f&quot;<span class="subst">&#123;ns1_api_key&#125;</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">    <span class="string">f&quot;<span class="subst">&#123;label&#125;</span>&quot;</span>:&#123;<span class="string">&quot;up&quot;</span>:status&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url,headers=headers,json=data)</span><br><span class="line">    <span class="built_in">print</span>(res.text,<span class="string">f&#x27;[status] <span class="subst">&#123;label&#125;</span> -&gt; \&#x27;up\&#x27;: <span class="subst">&#123;status&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>观测云平台配置</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/image.2h7f4pvb26g0.webp' data-fancybox='default' data-caption='观测云平台配置' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 48.072916666666664%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/image.2h7f4pvb26g0.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/image.2h7f4pvb26g0.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="观测云平台配置" loading="lazy">            </a><span class='image-caption'>观测云平台配置</span></div><br><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/image.1pa05ng98kps.webp' data-fancybox='default' data-caption='观测云平台配置' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 48.072916666666664%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/image.1pa05ng98kps.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/image.1pa05ng98kps.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="观测云平台配置" loading="lazy">            </a><span class='image-caption'>观测云平台配置</span></div></div></div>]]></content>
    
    
    <summary type="html">免费利用NS1权威DNS服务器实时基于不同运营商故障转移，利用监控宝平台监控指定网站</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>国内各个as自治系统[转]</title>
    <link href="https://xingpingcn.top/%E5%9B%BD%E5%86%85%E5%90%84%E4%B8%AAas%E7%B3%BB%E7%BB%9F.html"/>
    <id>https://xingpingcn.top/%E5%9B%BD%E5%86%85%E5%90%84%E4%B8%AAas%E7%B3%BB%E7%BB%9F.html</id>
    <published>2024-03-11T15:59:52.609Z</published>
    <updated>2024-03-11T15:59:52.609Z</updated>
    
    <content type="html"><![CDATA[<p>国内至国际骨干 ISP 线路整理</p><div class="note red"><p>电信的163骨干网自治系统编号 AS4134；电信的CN2骨干网自治系统编号 AS4809</p></div><div class="note yellow"><p>联通的169骨干网自治系统编号 AS4837；联通的A网骨干网自治系统编号 AS9929</p></div><div class="note blue"><p>移动的CMNET境内骨干网自治系统编号 AS9808；移动的CMI境外骨干网自治系统编号 AS58453</p></div><div class="note cyan"><p>CERNET骨干网自治系统编号 AS4538；CSTNET骨干网自治系统编号 AS7497</p></div><span id="more"></span>]]></content>
    
    
    <summary type="html">&lt;p&gt;国内至国际骨干 ISP 线路整理&lt;/p&gt;
&lt;div class=&quot;note red&quot;&gt;&lt;p&gt;电信的163骨干网自治系统编号 AS4134；电信的CN2骨干网自治系统编号 AS4809&lt;/p&gt;&lt;/div&gt;

&lt;div class=&quot;note yellow&quot;&gt;&lt;p&gt;联通的169骨干网自治系统编号 AS4837；联通的A网骨干网自治系统编号 AS9929&lt;/p&gt;&lt;/div&gt;

&lt;div class=&quot;note blue&quot;&gt;&lt;p&gt;移动的CMNET境内骨干网自治系统编号 AS9808；移动的CMI境外骨干网自治系统编号 AS58453&lt;/p&gt;&lt;/div&gt;

&lt;div class=&quot;note cyan&quot;&gt;&lt;p&gt;CERNET骨干网自治系统编号 AS4538；CSTNET骨干网自治系统编号 AS7497&lt;/p&gt;&lt;/div&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>尝试在闲置的surface pro 4上运行安卓应用</title>
    <link href="https://xingpingcn.top/try-to-run-apk-on-sp4.html"/>
    <id>https://xingpingcn.top/try-to-run-apk-on-sp4.html</id>
    <published>2024-03-11T15:59:52.608Z</published>
    <updated>2024-03-28T15:03:32.385Z</updated>
    
    <content type="html"><![CDATA[<p>目前的结论是能在使用触屏的同时运行安卓应用，也仅仅是能用。</p><span id="more"></span><p>目前尝试过几种方案</p><ul><li>fydo os</li><li><a href="https://blissos.org/index.html" target="_blank" rel="noopener external nofollow noreferrer">blissos</a></li><li>Ubuntu+anbox</li></ul><div class="story post-story"><h2 id="fydo-os"><a href="#fydo-os" class="headerlink" title="fydo os"></a>fydo os</h2><p>我只使用过免费版，目前体验下来是最流畅的，也是最不需要折腾的，但是目前免费版没触屏。遗憾</p></div><div class="story post-story"><h2 id="blissos"><a href="#blissos" class="headerlink" title="blissos"></a>blissos</h2><p>装上之后触屏时有时无，而在有的时候只是拙劣的鼠标点击模拟，基本的多指操作和滑动功能都没有，流畅度还不如<code>fydo os</code>，出的这个surface专版感觉就是纯粹让ppt好看些。</p></div><div class="story post-story"><h2 id="Ubuntu-anbox"><a href="#Ubuntu-anbox" class="headerlink" title="Ubuntu+anbox"></a>Ubuntu+anbox</h2><p>最后只能尝试在<code>Linux</code>上运行安卓了。</p><p>我装的是<code>LTS 22</code>，安装好系统后还得找hy2能用的客户端（因为要去GitHub下资源），一番折腾后找到了<a href="https://github.com/MatsuriDayo/nekoray/releases" target="_blank" rel="noopener external nofollow noreferrer">nekoray</a>这个带GUI的客户端（因为这个时候<code>sing-box</code>，<code>clashmeta</code>还有<code>hy2</code>官方都没有Linux GUI，而且路由配置还非常麻烦，没现成的作业可以抄），而<code>nekoray</code>后端用的就是<code>sing-box</code>，可惜<code>nekoray</code>自带广告。</p><p>之后刷入<a href="https://github.com/linux-surface/linux-surface/wiki/Installation-and-Setup" target="_blank" rel="noopener external nofollow noreferrer">Surface Linux Kernel</a>，触屏是有了，也仅仅是能用的程度，不太跟手，和<code>win</code>下的体验差太多。</p><p>之后安装anbox，一开始闪退，最后发现不是配置有问题，而是不支持5.17以上内核，安装<code>Surface Linux Kernel</code>的时候已经默认安装目前最新的6.6版本了，理论上降级是能用的，但是不知道修改过的<code>Surface Linux Kernel</code>能不能用，我也懒得再降级了。马上花10分钟打开PE滚回去<code>windows</code>。</p></div>]]></content>
    
    
    <summary type="html">尝试在闲置的surface pro 4上运行安卓应用</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>npm图床（不需要本地部署）</title>
    <link href="https://xingpingcn.top/npm%E5%9B%BE%E5%BA%8A%EF%BC%88%E4%B8%8D%E9%9C%80%E8%A6%81%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%EF%BC%89.html"/>
    <id>https://xingpingcn.top/npm%E5%9B%BE%E5%BA%8A%EF%BC%88%E4%B8%8D%E9%9C%80%E8%A6%81%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%EF%BC%89.html</id>
    <published>2024-03-11T15:59:52.607Z</published>
    <updated>2024-03-28T15:03:24.627Z</updated>
    
    <content type="html"><![CDATA[<p>本篇意在建立一个上传到GitHub repo自动发布package到npm空间的npm图床</p><span id="more"></span><div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本篇为<code>picture-bed-using-freecdn</code>脚本的教程之一。脚本意在提高静态博客的cdn稳定性。</p><div class="tag link"><a class="link-card" title="picture-bed-using-freecdn" href="https://github.com/xingpingcn/picture-bed-use-freecdn"><div class="left"><img src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">picture-bed-using-freecdn</p><p class="url">https://github.com/xingpingcn/picture-bed-use-freecdn</p></div></a></div><p>脚本的另一篇使用教程在这里<a href="/%E4%BD%BF%E7%94%A8freecdn-js%E6%8F%90%E9%AB%98hexo%E5%8D%9A%E5%AE%A2%E7%9A%84cdn%E7%A8%B3%E5%AE%9A%E6%80%A7.html"> [使用freecdn-js提高hexo博客的cdn稳定性]</a></p></div><div class="story post-story"><h2 id="建立用于储存图片等静态资源的npm图床"><a href="#建立用于储存图片等静态资源的npm图床" class="headerlink" title="建立用于储存图片等静态资源的npm图床"></a>建立用于储存图片等静态资源的npm图床</h2><p>可以放置js、css、图片（最好带上hash）等不经常变动的资源。</p><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><div class="note info"><p>准备工作网上有很多教程，这里不重复造轮子。请搜索“npm图床”</p></div><p>需要：</p><ul><li>npm账号，创建一个<code>token</code>；</li><li>GitHub账号：创建一个repo，并在repo的<code>setting</code>创建一个名为<code>NPM_TOKEN</code>的secrets，值为上面的<code>token</code>。</li></ul><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231001/image.2zlsco3s1iu0.png' data-fancybox='default' data-caption='添加NPM_TOKEN' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 53.88535031847134%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231001/image.2zlsco3s1iu0.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20231001/image.2zlsco3s1iu0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="添加NPM_TOKEN" loading="lazy">            </a><span class='image-caption'>添加NPM_TOKEN</span></div></div><h3 id="创建package-json"><a href="#创建package-json" class="headerlink" title="创建package.json"></a>创建package.json</h3><p>该文件指定了要上传的图床的名字和图床版本（不需要事先在npm空间创建一个空的package）；其中名字不能和现有的package重复，所以写的尽量长。</p><figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DO STUFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XDF&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>看好名称写就行，<code>version</code>尽量和我一样就行。</p><h3 id="创建GitHub-action"><a href="#创建GitHub-action" class="headerlink" title="创建GitHub action"></a>创建GitHub action</h3><p><code>GitHub action</code>可以在你把文件push或者release到repo时自动执行自定义命令，这里我们让他自动把我们push的图片发布到npm空间，使资源能通过npm cdn访问。</p><p>在reop的上方点击<code>Action</code>，然后点击<code>new workflow</code>，之后点击<code>set up a workflow yourself </code>，名字随便（我这里是npm-publish.yml），之后填入以下信息：</p><figure class="highlight yaml"><figcaption><span>npm-publish.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">npm-publish</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"><span class="attr">permissions:</span></span><br><span class="line">  <span class="attr">contents:</span> <span class="string">write</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">publish-npm:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="comment"># Clone 仓库</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">master</span></span><br><span class="line">      <span class="comment"># 安装 Node.js    </span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Node</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v4</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">&quot;20.x&quot;</span></span><br><span class="line">          <span class="attr">registry-url:</span> <span class="string">https://registry.npmjs.org/</span></span><br><span class="line">        </span><br><span class="line">      <span class="comment"># 发布 NPM 包</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Publish</span> <span class="string">Package</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          git config --global user.email &quot;email@email.com&quot;</span></span><br><span class="line"><span class="string">          git config --global user.name &quot;user_name&quot;</span></span><br><span class="line"><span class="string">          npm version patch</span></span><br><span class="line"><span class="string">          npm publish</span></span><br><span class="line"><span class="string"></span>        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">NODE_AUTH_TOKEN:</span> <span class="string">$</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Push</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">git</span> <span class="string">push</span></span><br></pre></td></tr></table></figure><p>其中的<code>master</code>要换成你<code>branch</code>（分支）的名字。<code>NPM_TOKEN</code>就是最开始在secrets填写的<code>token</code>，因此名字要对应上。<code>email</code>和<code>user_name</code>可以随便写。</p><h3 id="上传图片"><a href="#上传图片" class="headerlink" title="上传图片"></a>上传图片</h3><p>使用图床工具或者手动上传到GitHub repo就能自动发布到npm空间，可以看到npm包的版本<code>version</code>变化了（npm不支持覆盖发布，所以版本一定会变化），同时<code>.json</code>文件里面的版本也变化了，这得益于GitHub action。</p><p>这里推荐一个图床工具吧，只用于GitHub的，比较轻量，使用浏览器就行。</p><div class="tag link"><a class="link-card" title="PicX图床工具官方文档" href="https://picx-docs.xpoet.cn"><div class="left"><img src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230420/image.1anm5qwvdhnk.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230420/image.1anm5qwvdhnk.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">PicX图床工具官方文档</p><p class="url">https://picx-docs.xpoet.cn</p></div></a></div><h3 id="使用图片"><a href="#使用图片" class="headerlink" title="使用图片"></a>使用图片</h3><p>提供几个国内能用的npm cdn</p><figure class="highlight yaml"><figcaption><span>npm cdn</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">https://npm.onmicrosoft.cn/,</span></span><br><span class="line"><span class="string">https://jsd.onmicrosoft.cn/npm/,</span></span><br><span class="line"><span class="string">https://cdn.jsdelivr.net/npm/,</span></span><br><span class="line"><span class="string">https://unpkg.com/</span></span><br></pre></td></tr></table></figure><p>使用格式为：</p><figure class="highlight yaml"><figcaption><span>npm cdn</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">https://&#123;cdn&#125;/&#123;npm_name&#125;@&#123;version&#125;/path/to/resource.ext</span></span><br></pre></td></tr></table></figure><p>例如</p><figure class="highlight yaml"><figcaption><span>npm cdn</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">https://unpkg.com/html-hosting-for-xp@1.0.1/%E5%9C%A8python%E4%B8%AD%E8%BF%90%E8%A1%8Cbash%EF%BC%88windows%EF%BC%89.html</span></span><br><span class="line"><span class="string">https://jsd.onmicrosoft.cn/npm/p-hosting-for-xp@1.0.15/20230525/logo%20(2).ln5ua8psy9s.webp</span></span><br></pre></td></tr></table></figure><div class="note done"><p>freecdn-js可以把资源的响应头中的<code>mime</code>改成<code>text/html</code>（而不是原来的text&#x2F;plain），从而能够让浏览器渲染网页。我写的脚本支持自动把用于写作博客.md文件转换为对应的html cdn列表。见前言</p></div></div><div class="story post-story"><h2 id="建立用于储存html静态资源的npm图床"><a href="#建立用于储存html静态资源的npm图床" class="headerlink" title="建立用于储存html静态资源的npm图床"></a>建立用于储存html静态资源的npm图床</h2><p>同样图床可以储存html文件。我是在本地编译好博客然后发布到GitHub repo的，因而在push之后依然可以在action中把html发布到npm空间。</p><figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DO STUFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XDF&quot;</span></span><br><span class="line">  <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;*.html&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>这里的<code>package.json</code>多了一个<code>files</code>的<code>key</code>，表示只发布html文件到npm空间。<code>files</code>是一个列表（array），和.gitignore文件的写作规则一样。</p><p>这里的action中的<code>.yml</code>文件和储存图片的repo的<code>.yml</code>一样，但是要删去<code>npm version patch</code>这行。</p><p><code>npm version patch</code>的作用是更新version，在本地发布html之前（hexo d），在命令行输入<code>npm version patch</code>就能更新本地的<code>package.json</code>中的version（换而言之，在更新version之前，本地的<code>package.json</code>和<code>.yml</code>内容和<code>目录</code>要和GitHub repo的一致，然后push更新了version之后的<code>.json</code>之后，让action自动部署，发布html到npm空间）</p><div class="note warning"><p>如果用我的命令行上传博客会多次push本地文件，但是只在push html之前会更新version，那么之后的push会因为没有更新version而action部署失败，但是事实上没有什么影响</p></div></div><div class="story post-story"><h2 id="脚本的使用"><a href="#脚本的使用" class="headerlink" title="脚本的使用"></a>脚本的使用</h2><p>脚本链接见前言。如果你要使用npm空间，要在<code>config.py</code>中写上你的npm包名，用于查询最新的version。</p><div class="note warning"><p>同样需要注意替换你的branch</p></div><figure class="highlight bash"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">f:</span><br><span class="line"><span class="built_in">cd</span> f:/blog <span class="comment">#博客根目录</span></span><br><span class="line">hexo clean &amp;&amp; hexo g</span><br><span class="line"><span class="built_in">cd</span> f:/blog/package_json <span class="comment">#储存package.json和.yml的文件夹（注意.yml路径！！）</span></span><br><span class="line">npm version patch</span><br><span class="line"><span class="built_in">cd</span> f:/blog</span><br><span class="line">gulp</span><br><span class="line"><span class="comment"># 上传之前确保./public存在package.json和.yml（注意.yml路径！！）</span></span><br><span class="line">xcopy .\package_json .\public /e/h</span><br><span class="line">hexo d</span><br><span class="line"><span class="built_in">cd</span> f:/blog/.deploy_git</span><br><span class="line">python ../import_to_db_with_hexo_blog.py</span><br><span class="line">python ../import_to_db_with_urls_txt.py</span><br><span class="line">freecdn find --save</span><br><span class="line">freecdn manifest --merge ../pic.conf</span><br><span class="line">freecdn manifest --merge ../custom.conf -o manifest-full.txt <span class="comment">#用于生成外置的freecdn-manifest.txt</span></span><br><span class="line">freecdn js --make --cdn <span class="string">&quot;https://jsd.cdn.zzko.cn/gh/user/repo@main/freecdn-internal/ver/freecdn-main.min.js unpkg jsdelivr elemecdn &quot;</span> <span class="comment">#此命令为配置cdn链接用于加速.min.js文件，详细请查看freecdn项目的GitHub</span></span><br><span class="line">git add --all</span><br><span class="line">git commit -m <span class="string">&quot;update&quot;</span></span><br><span class="line">git push origin main <span class="comment">#如果需要添加origin地址，请自行添加。</span></span><br><span class="line">python ../generate_external_manifest_file.py</span><br><span class="line">git add --all</span><br><span class="line">git commit -m <span class="string">&quot;update&quot;</span></span><br><span class="line">git push origin main  <span class="comment">#如果“is_refresh_tag”为 “True”需要上传多次</span></span><br><span class="line">python ../refresh_cdn_cache.py <span class="comment">#可能没用</span></span><br></pre></td></tr></table></figure></div>]]></content>
    
    
    <summary type="html">不在本地部署npm图床通过cdn加速html、jpg等资源</summary>
    
    
    
    <category term="hexo折腾" scheme="https://xingpingcn.top/categories/hexo%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="npm" scheme="https://xingpingcn.top/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>docker学习笔记</title>
    <link href="https://xingpingcn.top/docker-learning-notes.html"/>
    <id>https://xingpingcn.top/docker-learning-notes.html</id>
    <published>2024-03-11T15:59:52.606Z</published>
    <updated>2024-11-03T11:43:40.946Z</updated>
    
    <content type="html"><![CDATA[<p>这是一篇通过配置hysteria2学习docker-compose的笔记</p><span id="more"></span><div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>用官方的docker和配置3分钟就搭好了，但是想试试通过bridge和通过nginx反代来实现（最后没有实验），于是就开始了折腾，，，</p></div><div class="story post-story"><h2 id="docker的network模式"><a href="#docker的network模式" class="headerlink" title="docker的network模式"></a>docker的network模式</h2><p>docker会隔离文件、网络、进程，而网络的隔离程度分为4种：</p><ul><li><code>host</code> 这个相当于和主机共用一个网络</li><li><code>none</code> 容器不需要内部和外部网络</li><li><code>container</code> 似乎是容器内的网络，和主机分离。</li><li><code>bridge</code> 命令<code>docker network create</code>的默认模式，连接到该网络的容器可以互相连通，而且可以暴露端口给主机和主机通讯。客户端通过<code>主机ip:port</code>访问。</li></ul><div class="note done"><p><strong>NOTE</strong></p><p>docker默认创建除<code>container</code>的三个网络。可以通过<code>docker network ls</code>查看。</p></div><figure class="highlight bash"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@:/bin/hy2<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME          DRIVER    SCOPE</span><br><span class="line">c069db7ead85   bridge        bridge    <span class="built_in">local</span></span><br><span class="line">cf668a8174a8   host          host      <span class="built_in">local</span></span><br><span class="line">162c8b1b3229   nginx-proxy   bridge    <span class="built_in">local</span> <span class="comment"># `nginx-proxy`是我自己创建的。</span></span><br><span class="line">4f9ce671d49a   none          null      <span class="built_in">local</span></span><br></pre></td></tr></table></figure><div class="note done"><p><strong>NOTE</strong></p><p>值得注意的是，docker默认创建一个名为docker0的网口用于连接主机和容器。通过<code>ip link</code>查看<br>进入hy2容器执行<code>ip link</code>命令可以看到，hy2的网卡（<code>eth0</code>）是和主机上的<code>veth6f76815</code>虚拟网卡连接（240:241）</p></div><figure class="highlight bash"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@445:/bin/hy2<span class="comment"># ip link</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether [隐私删除] brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp0s3</span><br><span class="line">    altname ens3</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default </span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:4e:38:4d:51 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">12: br-162c8b1b3229: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT group default </span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:93:b0:6a:4a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">223: veth3452fbb@if222: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-162c8b1b3229 state UP mode DEFAULT group default </span><br><span class="line">    <span class="built_in">link</span>/ether d2:85:53:63:a1:76 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">241: veth6f76815@if240: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-162c8b1b3229 state UP mode DEFAULT group default </span><br><span class="line">    <span class="built_in">link</span>/ether aa:e0:71:cf:9e:50 brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">root@445:/bin/hy2<span class="comment"># docker exec -it hy2 /bin/bash</span></span><br><span class="line">1cb800f27bd1:/<span class="comment"># ip link</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">240: eth0@if241: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP </span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:ac:14:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">1cb800f27bd1:/<span class="comment"># </span></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="配置hy2的yaml"><a href="#配置hy2的yaml" class="headerlink" title="配置hy2的yaml"></a>配置hy2的yaml</h2><p>官方的<code>yaml</code>是使用的<code>host</code>模式，我现在要创建一个名为<code>nginx-proxy</code>的网络并且在配置文件中更改。</p><figure class="highlight yaml"><figcaption><span>yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.9&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">hysteria:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">tobyxdd/hysteria</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hy2</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">acme:/acme</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./hysteria.yaml:/etc/hysteria.yaml</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;server&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;/etc/hysteria.yaml&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nginx-proxy</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;10808:443&quot;</span></span><br><span class="line">    <span class="comment"># expose:</span></span><br><span class="line">    <span class="comment">#   - &quot;443&quot;</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">nginx-proxy:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">acme:</span></span><br></pre></td></tr></table></figure><p>这样我以为就可以通过访问<code>10808</code>端口科学上网了。但是ping不通，，，</p><p>经过努力的排查，找到了<code>docker inspect</code>命令，发现容器被分配的<code>IP</code>是空的，，，</p><p>原来还需要手动通过输入<code>docker network connect</code>来连接，，，我看<code>nginx</code>是自动连接的，不知道对应的yaml怎么写。</p><p>结果还是是ping不通，，，</p><p>用<code>iptables -t nat -nvL --line-number</code>查看发现，<code>Chain DOCKER</code>里也有容器IP的<code>DNAT</code>了，为什么还是不行。</p><p>不细心眼力不好还发现不了，是暴露端口的时候默认暴露tcp，，，。结合hy2文档也知道hy2是基于udp的，然后更改配置</p><figure class="highlight yaml"><figcaption><span>yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">hysteria:</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;10808:443/udp&quot;</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></table></figure><p>成功！</p><p>但是关闭连接的时候就会出错再也连不上，通过日志发现，原来关闭的时候通过<code>tcp</code>沟通的。</p><p>最终的配置文档应该像这样的</p><figure class="highlight yaml"><figcaption><span>yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">hysteria:</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;10808:443/udp&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;10808:443/tcp&quot;</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></table></figure><p>最后删除多余的NAT，和设置新的NAT，并备份iptables</p><div class="note warning"><p><strong>warning</strong></p><p><code>iptables-save -f /etc/iptables/rules.v4</code>适用于Debian，其他系统可能会恢复不了<code>iptables</code></p></div><figure class="highlight bash"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -D PREROUTING 1</span><br><span class="line">iptables -t nat -A PREROUTING -i eth0 -p udp --dport 20000:50000 -j DNAT --to-destination :10808</span><br><span class="line">iptables-save -f /etc/iptables/rules.v4</span><br><span class="line">systemctl restart iptables</span><br></pre></td></tr></table></figure><div class="note warning"><p><strong>warning</strong></p><p>如果使用<code>ufw</code>，则修改以下文件。重启<code>ufw</code>的时候不会删除<code>iptables</code>已经有的规则，也就是说重复重启<code>ufw</code>会添加多条相同的规则，需要手动删除。</p><figure class="highlight bash"><figcaption><span>/etc/ufw/sysctl.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net/ipv4/ip_forward=1</span><br></pre></td></tr></table></figure><div class="note warning"><p><strong>warning</strong></p><p>注意！必须在前一个filter block最后，即COMMIT之后添加！</p><p>最后只放行那个要转发的端口！</p><p>例如<code>ufw allow 12345</code>，而不是<code>ufw allow 20000-50000</code></p></div><figure class="highlight bash"><figcaption><span>/etc/ufw/before.rules</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意！必须在前一个filter block最后，即COMMIT之后添加！</span></span><br><span class="line"><span class="comment"># don&#x27;t delete the &#x27;COMMIT&#x27; line or these rules won&#x27;t be processed</span></span><br><span class="line">COMMIT</span><br><span class="line"></span><br><span class="line"><span class="comment"># Custom</span></span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [0:0]</span><br><span class="line">-A PREROUTING -i eth0 -p udp --dport 10000:30000 -j DNAT --to-destination :3456</span><br><span class="line"></span><br><span class="line">COMMIT</span><br></pre></td></tr></table></figure></div><p>最后放上配置</p><figure class="highlight yaml"><figcaption><span>yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">listen:</span> <span class="string">:10808</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#acme:</span></span><br><span class="line">  <span class="comment">#domains:</span></span><br><span class="line">  <span class="comment">#  -  xxx #把xxx.com改成你的域名，需要先解析到服务器ip</span></span><br><span class="line">  <span class="comment">#email: @gmail.com #可以改成自己邮箱，也可以把test这里随便加几个字符</span></span><br><span class="line"><span class="attr">tls:</span></span><br><span class="line">  <span class="attr">cert:</span> <span class="string">/etc/cert/domain.com.cert.pem</span></span><br><span class="line">  <span class="attr">key:</span> <span class="string">/etc/cert/domain.com.key.pem</span></span><br><span class="line"><span class="attr">auth:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">password</span></span><br><span class="line">  <span class="attr">password:</span> <span class="comment">#设置密码</span></span><br><span class="line"></span><br><span class="line"><span class="attr">masquerade:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">proxy</span></span><br><span class="line">  <span class="attr">proxy:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://bing.com</span> <span class="comment">#伪装网址</span></span><br><span class="line">    <span class="attr">rewriteHost:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">quic:</span></span><br><span class="line">  <span class="attr">initStreamReceiveWindow:</span> <span class="number">26843545</span> </span><br><span class="line">  <span class="attr">maxStreamReceiveWindow:</span> <span class="number">26843545</span> </span><br><span class="line">  <span class="attr">initConnReceiveWindow:</span> <span class="number">67108864</span> </span><br><span class="line">  <span class="attr">maxConnReceiveWindow:</span> <span class="number">67108864</span> </span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="nginx初次使用"><a href="#nginx初次使用" class="headerlink" title="nginx初次使用"></a>nginx初次使用</h2><p>由于nginx运行在<code>docker</code>内，而每个<code>docker</code>都会被<code>network</code>的虚拟网关分配一个<code>ip</code>，如果nginx要反代同一<code>network</code>内的<code>docker container</code>是不是就要预先知道它的ip呢？这样做其实也可以，但是如果机器重启就会出问题，因为重启后每个容器的ip会被重新分配，分配的规则我猜测是根据启动顺序来决定的。更优雅的方式是直接使用<code>container</code>的别名作为<code>ip</code>。</p><p>例如在同一网络内有两个<code>container</code>，别名分别为<code>nginx_test</code>和<code>api</code>，则<code>nginx_test</code>的反代配置应该是类似于这样的。</p><figure class="highlight bash"><figcaption><span>.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    location /api &#123;</span><br><span class="line">        proxy_pass http://api:3000;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上情况只是适用于nginx通过<code>docker</code>部署的情况。而我用的是直接安装在主机的方式，反代的容器需要暴露端口到<code>localhost</code>。</p><figure class="highlight yaml"><figcaption><span>yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">hysteria:</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;127.0.0.1:3000:443/udp&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;127.0.0.1:3000:443/tcp&quot;</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></table></figure><p>这样子，使用<code>ip:10808</code>就不能访问了，必须在nginx那里反代<code>proxy_pass http://127.0.0.1:3000;</code>通过<code>ip:443</code>访问</p><div class="note warning"><p><strong>WARNING</strong></p><p>hy2 并不支持和 nginx 共享 443 端口，所以需要自己用 acme 申请证书，然后在 hy2 的配置中填写 tls </p></div><h3 id="nginx安装和证书自动申请"><a href="#nginx安装和证书自动申请" class="headerlink" title="nginx安装和证书自动申请"></a>nginx安装和证书自动申请</h3><p>意外地发现需要结合多个教程才能搞定，记录一下备忘</p><p>有两种方法，一种是acme.sh，一种是Certbot，后者更加方便，但是过程中做了什么我不知道，前者需要手动的地方更多，但是你会知道证书放在了哪里。</p><p>可以先设置软连接。注意路径，第一个为默认的nginx配置路径，第二个为你要软连接的路径。</p><figure class="highlight bash"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /etc/nginx/nginx.conf /home/nginx/nginx.conf</span><br></pre></td></tr></table></figure><h4 id="acme-sh"><a href="#acme-sh" class="headerlink" title="acme.sh"></a>acme.sh</h4><p>先在<code>conf</code>中写好域名，<code>acme.sh</code>会根据配置帮你申请域名</p><figure class="highlight plaintext"><figcaption><span>conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    server_name domain.com; </span><br><span class="line">    listen 80;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>安装<code>acme.sh</code>后，<code>重新</code>打开一个终端，输入以下命令；需要域名先指向你的vps</p><figure class="highlight bash"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue  -d  domain.com --nginx /home/nginx/nginx.conf </span><br></pre></td></tr></table></figure><p>这里有个可以不用<code>nginx</code>的方法，如果使用的是华为云，可以运行以下命令。原理就是利用api自动添加txt记录。如果需要更多支持的dns请点击<a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi" target="_blank" rel="noopener external nofollow noreferrer">这里</a>，基本上包含了主流dns服务器了。</p><figure class="highlight bash"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HUAWEICLOUD_Username=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">export</span> HUAWEICLOUD_Password=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">export</span> HUAWEICLOUD_DomainName=<span class="string">&quot;&quot;</span> <span class="comment"># 注意的是这个的中文名为账户名而不是域名，需要你去设置里面查看</span></span><br><span class="line">acme.sh --issue --dns dns_huaweicloud -d example.com -d *.example.com <span class="comment">#填写你的域名</span></span><br></pre></td></tr></table></figure><p>最后运行以下命令。快到期会自动续。注意路径。</p><figure class="highlight bash"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --install-cert -d domain.com \</span><br><span class="line">--key-file      /home/nginx/cert/domain.com.key.pem  \</span><br><span class="line">--fullchain-file /home/nginx/cert/domain.com.cert.pem \</span><br><span class="line">--reloadcmd     <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure><p>第一个命令是申请证书，证书会放在<code>acme.sh</code>自己脚本所在的目录，所以后面要使用<code>--install-cert</code>安装。这个并不会修改<code>conf</code>，所以要手动配置。</p><p>再打开<code>conf</code>，填写<code>443</code>端口，之后就会在过期前30天自动更新</p><figure class="highlight plaintext"><figcaption><span>conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">listen 443 ssl;</span><br><span class="line">server_name domain.com;</span><br><span class="line">location /&#123;</span><br><span class="line">client_max_body_size  64m;</span><br><span class="line">proxy_http_version 1.1;</span><br><span class="line">proxy_pass http://localhost:8080;  # 请根据实际情况修改你的端口</span><br><span class="line">proxy_set_header Host $host;</span><br><span class="line">proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">proxy_cache_bypass $http_upgrade;</span><br><span class="line">proxy_set_header Accept-Encoding gzip;</span><br><span class="line">proxy_read_timeout 360s;  # GPT-4 需要较长的超时时间，请自行调整</span><br><span class="line">&#125;</span><br><span class="line">ssl_certificate   /home/nginx/cert/domain.com.cert.pem;</span><br><span class="line">    ssl_certificate_key  /home/nginx/cert/domain.com.key.pem;</span><br><span class="line"></span><br><span class="line">      # ssl_session_cache shared:SSL:1m;</span><br><span class="line">      # ssl_session_timeout 5m;</span><br><span class="line">      # ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line"></span><br><span class="line">access_log    /home/nginx/log/domain.com.access.log;</span><br><span class="line">error_log     /home/nginx/log/domain.com.error.log;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Certbot"><a href="#Certbot" class="headerlink" title="Certbot"></a>Certbot</h4><figure class="highlight bash"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo snap install --classic certbot</span><br><span class="line">sudo <span class="built_in">ln</span> -s /snap/bin/certbot /usr/bin/certbott</span><br></pre></td></tr></table></figure><p>之后conf中填写好<code>443</code>端口</p><p>使用 certbot 获取 SSL 证书：<code>sudo certbot --nginx</code></p><p><code>sudo vim ./push</code>查看更改。重启<code>nginx</code></p><h3 id="重启nginx"><a href="#重启nginx" class="headerlink" title="重启nginx"></a>重启nginx</h3><p>有两个，前者确定不会重启<code>nginx</code>，后者应该会。</p><figure class="highlight bash"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br><span class="line">service nginx restart</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="容器更新"><a href="#容器更新" class="headerlink" title="容器更新"></a>容器更新</h2><figure class="highlight bash"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose pull</span><br><span class="line">docker-compose up -d --remove-orphans <span class="comment"># 重启</span></span><br><span class="line">docker image prune <span class="comment"># 删除旧的</span></span><br></pre></td></tr></table></figure></div>]]></content>
    
    
    <summary type="html">通过学习docker-compose将hysteria2通过bridge模式提供服务</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>v2ray+ws+tls太慢解决方法</title>
    <link href="https://xingpingcn.top/v2raywstls%E5%A4%AA%E6%85%A2%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95.html"/>
    <id>https://xingpingcn.top/v2raywstls%E5%A4%AA%E6%85%A2%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95.html</id>
    <published>2023-05-25T09:41:15.519Z</published>
    <updated>2024-06-05T14:15:54.146Z</updated>
    
    <content type="html"><![CDATA[<p>目前推荐hysteria，一个比较新的协议，gfw似乎还没有针对这个做出限制。<br>我自己搭建梯子的话感觉kcp和ws+tls是比较快的，但是kcp容易被墙，而且掉包有点高，ws+tls需要用上cf的cdn加速才能快，而且要筛选速度快的cf的ip才能快（目前来看稳定性较差，建议用hysteria搭建梯子）。</p><span id="more"></span><div class="note info"><p><strong>info</strong></p><p>放上<code>hy2</code>的<a href="/docker-learning-notes.html">搭建方法</a></p></div><p>先看优化结果</p><div class="note success"><p>如果用hysteria在非晚高峰可以秒开4k60fps，晚高峰秒开1080p60fps。cf的cdn则看运气</p></div><div class="note warning"><p>如果用hysteria会时不时变卡，建议vps设置自动在凌晨重启</p></div><div class="tag link"><a class="link-card" title="hysteria一键搭建" href="https://github.com/emptysuns/Hi_Hysteria"><div class="left"><img src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">hysteria一键搭建</p><p class="url">https://github.com/emptysuns/Hi_Hysteria</p></div></a></div><p>下面是加了cdn的结果</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.5rkudgvs3rk0.png' data-fancybox='default' data-caption='cf-cdn优化后的速度（速度在一直增加，峰值跑到200m不是问题）' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 51.35782747603834%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.5rkudgvs3rk0.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.5rkudgvs3rk0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="cf-cdn优化后的速度（速度在一直增加，峰值跑到200m不是问题）" loading="lazy">            </a><span class='image-caption'>cf-cdn优化后的速度（速度在一直增加，峰值跑到200m不是问题）</span></div></div><p>没有优化的话速度简直不能看。</p><div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>推荐使用hysteria（区别于ws+tls+cdn，这个协议不能添加也不需要添加cdn）。</p><div class="tag link"><a class="link-card" title="hysteria一键搭建" href="https://github.com/emptysuns/Hi_Hysteria"><div class="left"><img src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">hysteria一键搭建</p><p class="url">https://github.com/emptysuns/Hi_Hysteria</p></div></a></div><p>如要添加cdn则需要：<br>1、<code>vps</code>，我用的是免费的亚马逊云香港服务器ec2（2c1g）<br>2、一个域名，可以到<a href="https://www.namesilo.com/domain/search-domains?rid=e824566hn" target="_blank" rel="noopener external nofollow noreferrer">namesilo(点击购买域名)</a>，<code>.xyz</code>域名只需要0.99刀一年，第二年重新换一个就可以。支持支付宝付费，还不用实名，送邮箱域名和隐私保护。<br>3、<code>cloudflare</code>账号（没有的账号的，去<code>谷歌</code>搜索然后注册）<br>4、cf ip自选工具<a href="https://github.com/XIU2/CloudflareSpeedTest" target="_blank" rel="noopener external nofollow noreferrer">点击查看</a><br>5、 <a href="https://github.com/jinwyp/one_click_script" target="_blank" rel="noopener external nofollow noreferrer">Easy install latest or LTS linux kernel and enable BBR or BBR plus</a><br><a href="https://roov.org/2020/03/bbr-bbrplus-bbr2/#toc_3" target="_blank" rel="noopener external nofollow noreferrer">BBR vs BBRplus vs BBR2 一般网络速度对比</a></p><p>默认已经搭建v2ray，没有搭建的可以查看<a href="https://github.com/233boy/v2ray" target="_blank" rel="noopener external nofollow noreferrer">这里</a></p></div><div class="story post-story"><h2 id="域名添加a记录到vps的ip"><a href="#域名添加a记录到vps的ip" class="headerlink" title="域名添加a记录到vps的ip"></a>域名添加a记录到vps的ip</h2><p>因为我们要用到<code>cloudflare</code>的<code>cdn</code>，所以买到域名之后直接把<code>nameserver</code>（NS）改成<code>cloudflare</code>提供的<code>NS</code>。</p><p>需要在<code>cloudflare</code>账号中添加你的域名，<code>cf</code>会给你<code>NS</code>，然后到域名供应商的设置页面更换域名的<code>NS</code>。</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.68re7eh8w2k0.webp' data-fancybox='default' data-caption='cloudflare提供的NS' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 25.530035335689046%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.68re7eh8w2k0.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.68re7eh8w2k0.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="cloudflare提供的NS" loading="lazy">            </a><span class='image-caption'>cloudflare提供的NS</span></div></div><p>如果是在<code>namesilo</code>买的，更换<code>NS</code>的入口还比较隐蔽，点击看下图可以查看入口。</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.6yhg5c0hr6w0.webp' data-fancybox='default' data-caption='namesilo NS更换入口' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 23.04075235109718%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.6yhg5c0hr6w0.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.6yhg5c0hr6w0.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="namesilo NS更换入口" loading="lazy">            </a><span class='image-caption'>namesilo NS更换入口</span></div></div><p>之后自定义一个二级域名，例如<code>forv2ray.example.com</code>，添加<code>A</code>记录到你的<code>vps ip</code>。并且开启<code>cdn</code>（如出现下图<code>代理状态</code>的图标，则开启成功。或需要等一段时间才能生效）</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.4kwet6hmt6e0.webp' data-fancybox='default' data-caption='cloudflare添加A记录' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 8.690869086908691%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.4kwet6hmt6e0.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.4kwet6hmt6e0.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="cloudflare添加A记录" loading="lazy">            </a><span class='image-caption'>cloudflare添加A记录</span></div></div><p>之后把证书加密模式改成完全（full）</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.42rhvl10gk00.webp' data-fancybox='default' data-caption='把证书加密模式改成完全（full）' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 28.774120317820657%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.42rhvl10gk00.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.42rhvl10gk00.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="把证书加密模式改成完全（full）" loading="lazy">            </a><span class='image-caption'>把证书加密模式改成完全（full）</span></div></div><p>这个时候可以<code>ping</code>一下你的二级域名，或者测一下<code>v2ray</code>的速度了，不过应该很慢。</p><p>证书的话我是脚本自动生成的，当然也可以到cf设置 -&gt; SSL&#x2F;TLS -&gt; 源服务器生成。</p></div><div class="story post-story"><h2 id="筛选适合的cloudflare-ip"><a href="#筛选适合的cloudflare-ip" class="headerlink" title="筛选适合的cloudflare ip"></a>筛选适合的cloudflare ip</h2><div class="tag link"><a class="link-card" title="ip筛选工具" href="https://github.com/XIU2/CloudflareSpeedTest"><div class="left"><img src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230506/pngwing.com.yfryst5dm0w.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">ip筛选工具</p><p class="url">https://github.com/XIU2/CloudflareSpeedTest</p></div></a></div><p>下载后打开运行，记得关掉你的梯子，然后将最快的ip填写到你的<code>v2ray</code>客户端的地址（addres）位置。</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox' style='position: relative; width: 100%;'>            <a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.5k737u1z06c0.webp' data-fancybox='default' data-caption='更改v2ray设置' style="position: relative;background-color: rgb(204, 204, 204); padding-bottom: 100.89058524173028%;color:gray;">            <svg class="spinner0" viewBox="0 0 50 50"> <circle class="path0" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle></svg>            <img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.5k737u1z06c0.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230525/image.5k737u1z06c0.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="更改v2ray设置" loading="lazy">            </a><span class='image-caption'>更改v2ray设置</span></div></div><p>其中的伪装域名填写你在<code>cf</code>添加<code>A</code>记录到<code>vps IP</code>的二级域名。  </p><p>这个时候你就可以去测速了（或需要等待一段时间生效）</p></div>]]></content>
    
    
    <summary type="html">v2ray太慢 用自选cloudflare 自选ip解决 ws+tls</summary>
    
    
    
    
    <category term="v2ray" scheme="https://xingpingcn.top/tags/v2ray/"/>
    
  </entry>
  
  <entry>
    <title>在GIT中忽略文件操作[转]</title>
    <link href="https://xingpingcn.top/%E5%9C%A8GIT%E4%B8%AD%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C[%E8%BD%AC].html"/>
    <id>https://xingpingcn.top/%E5%9C%A8GIT%E4%B8%AD%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C[%E8%BD%AC].html</id>
    <published>2023-05-08T15:32:18.776Z</published>
    <updated>2023-05-08T15:38:36.136Z</updated>
    
    <content type="html"><![CDATA[]]></content>
    
    
      
      
    <summary type="html">
</summary>
      
    
    
    
    
  </entry>
  
</feed>
