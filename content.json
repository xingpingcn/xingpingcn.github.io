{"meta":{"title":"邢平cn's blog","subtitle":"","description":"写一些东西，分享踩过的坑","author":"邢平cn","url":"https://xingpingcn.top","root":"/"},"pages":[{"title":"","date":"2023-04-22T18:34:44.435Z","updated":"2023-04-22T18:34:44.435Z","comments":true,"path":"404.html","permalink":"https://xingpingcn.top/404.html","excerpt":"","text":"404 很抱歉，您访问的页面不存在 请点击主页搜索并查看具体文章（或许是Google搜索出了问题） 也可能是输入地址有误或该地址已被删除 欢迎在评论区留言，或者到我的github主页私信我"},{"title":"关于网站和我","date":"2023-04-25T14:14:56.317Z","updated":"2023-04-25T14:14:56.317Z","comments":true,"path":"about/index.html","permalink":"https://xingpingcn.top/about/index.html","excerpt":"","text":"关于网站本站分享一些各方面踩过的坑（不是什么突破性的成就，也可能不是成功经验，而是一些失败过的经验），为有相似经历的人提供参考，共同学习；一些笔记、随笔、研究成果。 本站建于2023.4.18 关于我喜欢分享踩过的坑，热爱社会科学和计算机技术。 写在最后欢迎在评论区评论，或者Email我，基本上都会回复。"},{"title":"","date":"2023-04-21T13:06:25.863Z","updated":"2023-04-21T13:06:25.863Z","comments":true,"path":"google4e035139f56cb1e9.html","permalink":"https://xingpingcn.top/google4e035139f56cb1e9.html","excerpt":"","text":"google-site-verification: google4e035139f56cb1e9.html"},{"title":"所有标签","date":"2023-04-18T13:29:16.666Z","updated":"2023-04-18T13:29:16.666Z","comments":true,"path":"tags/index.html","permalink":"https://xingpingcn.top/tags/index.html","excerpt":"","text":""},{"title":"所有分类","date":"2023-04-19T17:00:58.363Z","updated":"2023-04-19T17:00:44.816Z","comments":true,"path":"categories/index.html","permalink":"https://xingpingcn.top/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"npm图床（不需要本地部署）","slug":"npm图床（不需要本地部署）","date":"2023-09-30T16:46:24.404Z","updated":"2023-09-30T19:51:32.705Z","comments":true,"path":"npm图床（不需要本地部署）.html","link":"","permalink":"https://xingpingcn.top/npm%E5%9B%BE%E5%BA%8A%EF%BC%88%E4%B8%8D%E9%9C%80%E8%A6%81%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%EF%BC%89.html","excerpt":"本篇意在建立一个上传到GitHub repo自动发布package到npm空间的npm图床","text":"本篇意在建立一个上传到GitHub repo自动发布package到npm空间的npm图床 前言本篇为picture-bed-using-freecdn脚本的教程之一。脚本意在提高静态博客的cdn稳定性。 picture-bed-using-freecdnhttps://github.com/xingpingcn/picture-bed-use-freecdn 脚本的另一篇使用教程在这里 [使用freecdn-js提高hexo博客的cdn稳定性] 建立用于储存图片等静态资源的npm图床可以放置js、css、图片（最好带上hash）等不经常变动的资源。 准备工作准备工作网上有很多教程，这里不重复造轮子。请搜索“npm图床” 需要： npm账号，创建一个token； GitHub账号：创建一个repo，并在repo的setting创建一个名为NPM_TOKEN的secrets，值为上面的token。 添加NPM_TOKEN 创建package.json该文件指定了要上传的图床的名字和图床版本（不需要事先在npm空间创建一个空的package）；其中名字不能和现有的package重复，所以写的尽量长。 package.json123456&#123; &quot;name&quot;: &quot;&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;description&quot;: &quot;DO STUFF&quot;, &quot;author&quot;: &quot;XDF&quot;&#125; 看好名称写就行，version尽量和我一样就行。 创建GitHub actionGitHub action可以在你把文件push或者release到repo时自动执行自定义命令，这里我们让他自动把我们push的图片发布到npm空间，使资源能通过npm cdn访问。 在reop的上方点击Action，然后点击new workflow，之后点击set up a workflow yourself ，名字随便（我这里是npm-publish.yml），之后填入以下信息： npm-publish.yml12345678910111213141516171819202122232425262728293031323334353637name: npm-publishon: push: branches: - masterpermissions: contents: write jobs: publish-npm: runs-on: ubuntu-latest # Clone 仓库 steps: - name: Checkout uses: actions/checkout@v2 with: ref: master # 安装 Node.js - name: Setup Node uses: actions/setup-node@v1 with: node-version: &quot;12.x&quot; registry-url: https://registry.npmjs.org/ # 发布 NPM 包 - name: Publish Package run: | git config --global user.email &quot;email@email.com&quot; git config --global user.name &quot;user_name&quot; npm version patch npm publish env: NODE_AUTH_TOKEN: $ - name: Push run: | git push 其中的master要换成你branch（分支）的名字。NPM_TOKEN就是最开始在secrets填写的token，因此名字要对应上。email和user_name可以随便写。 上传图片使用图床工具或者手动上传到GitHub repo就能自动发布到npm空间，可以看到npm包的版本version变化了（npm不支持覆盖发布，所以版本一定会变化），同时.json文件里面的版本也变化了，这得益于GitHub action。 这里推荐一个图床工具吧，只用于GitHub的，比较轻量，使用浏览器就行。 PicX图床工具官方文档https://picx-docs.xpoet.cn 使用图片提供几个国内能用的npm cdn npm cdn1234https://npm.onmicrosoft.cn/,https://jsd.onmicrosoft.cn/npm/,https://cdn.jsdelivr.net/npm/,https://unpkg.com/ 使用格式为： npm cdn1https://&#123;cdn&#125;/&#123;npm_name&#125;@&#123;version&#125;/path/to/resource.ext 例如 npm cdn12https://unpkg.com/html-hosting-for-xp@1.0.1/%E5%9C%A8python%E4%B8%AD%E8%BF%90%E8%A1%8Cbash%EF%BC%88windows%EF%BC%89.htmlhttps://jsd.onmicrosoft.cn/npm/p-hosting-for-xp@1.0.15/20230525/logo%20(2).ln5ua8psy9s.webp freecdn-js可以把资源的响应头中的mime改成text/html（而不是原来的text&#x2F;plain），从而能够让浏览器渲染网页。我写的脚本支持自动把用于写作博客.md文件转换为对应的html cdn列表。见前言 建立用于储存html静态资源的npm图床同样图床可以储存html文件。我是在本地编译好博客然后发布到GitHub repo的，因而在push之后依然可以在action中把html发布到npm空间。 package.json123456789&#123; &quot;name&quot;: &quot;&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;description&quot;: &quot;DO STUFF&quot;, &quot;author&quot;: &quot;XDF&quot; &quot;files&quot;: [ &quot;*.html&quot; ]&#125; 这里的package.json多了一个files的key，表示只发布html文件到npm空间。files是一个列表（array），和.gitignore文件的写作规则一样。 这里的action中的.yml文件和储存图片的repo的.yml一样，但是要删去npm version patch这行。 npm version patch的作用是更新version，在本地发布html之前（hexo d），在命令行输入npm version patch就能更新本地的package.json中的version（换而言之，在更新version之前，本地的package.json和.yml内容和目录要和GitHub repo的一致，然后push更新了version之后的.json之后，让action自动部署，发布html到npm空间） 如果用我的命令行上传博客会多次push本地文件，但是只在push html之前会更新version，那么之后的push会因为没有更新version而action部署失败，但是事实上没有什么影响 脚本的使用脚本链接见前言。如果你要使用npm空间，要在config.py中写上你的npm包名，用于查询最新的version。 同样需要注意替换你的branch bash12345678910111213141516171819202122232425f:cd f:/blog #博客根目录hexo clean &amp;&amp; hexo gcd f:/blog/package_json #储存package.json和.yml的文件夹（注意.yml路径！！）npm version patchcd f:/bloggulp# 上传之前确保./public存在package.json和.yml（注意.yml路径！！）xcopy .\\package_json .\\public /e/hhexo dcd f:/blog/.deploy_gitpython ../import_to_db_with_hexo_blog.pypython ../import_to_db_with_urls_txt.pyfreecdn find --savefreecdn manifest --merge ../pic.conffreecdn manifest --merge ../custom.conf -o manifest-full.txt #用于生成外置的freecdn-manifest.txtfreecdn js --make --cdn &quot;https://jsd.cdn.zzko.cn/gh/user/repo@main/freecdn-internal/ver/freecdn-main.min.js unpkg jsdelivr elemecdn &quot; #此命令为配置cdn链接用于加速.min.js文件，详细请查看freecdn项目的GitHubgit add --allgit commit -m &quot;update&quot;git push origin main #如果需要添加origin地址，请自行添加。python ../generate_external_manifest_file.pygit add --allgit commit -m &quot;update&quot;git push origin main #如果“is_refresh_tag”为 “True”需要上传多次python ../refresh_cdn_cache.py #可能没用","categories":[{"name":"hexo折腾","slug":"hexo折腾","permalink":"https://xingpingcn.top/categories/hexo%E6%8A%98%E8%85%BE/"}],"tags":[{"name":"npm","slug":"npm","permalink":"https://xingpingcn.top/tags/npm/"}]},{"title":"在python中运行bash实时输出结果（windows）","slug":"在python中运行bash（windows）","date":"2023-09-25T17:00:30.846Z","updated":"2023-09-26T13:35:05.153Z","comments":true,"path":"在python中运行bash（windows）.html","link":"","permalink":"https://xingpingcn.top/%E5%9C%A8python%E4%B8%AD%E8%BF%90%E8%A1%8Cbash%EF%BC%88windows%EF%BC%89.html","excerpt":"在windows的cmd中是不能运行bash的，我们需要利用git工具的bash来运行，但是用subprocess.run()会出问题，例如不能使用已经添加到环境变量的命令，如nvm、adb等；因此改用subprocess.Popen()","text":"在windows的cmd中是不能运行bash的，我们需要利用git工具的bash来运行，但是用subprocess.run()会出问题，例如不能使用已经添加到环境变量的命令，如nvm、adb等；因此改用subprocess.Popen() 批量输入并且最后输出所有结果bash_path用于定位你的git工具的bash，参数cwd=用于定位你的工作目录，和在文件夹中右键git bash here是一样的效果。 输入的命令可以带有空格，但是必须在最后加上\\n example-112345678910111213141516import subprocessbash_path = r&#x27;F:\\Program Files\\Git\\bin\\bash.exe&#x27;subp = subprocess.Popen(bash_path,stdin=subprocess.PIPE,stdout=subprocess.PIPE,stderr=subprocess.PIPE,encoding=&#x27;utf8&#x27;,cwd=&#x27;$your_path&#x27;)#输入的命令可以带有空格，但是必须在最后加上`\\n`subp.stdin.write(&#x27;nvm -v\\n&#x27;)subp.stdin.flush()subp.stdin.write(&#x27;nvm -v\\n&#x27;)subp.stdin.flush()subp.stdin.write(&#x27;nvm -v\\n&#x27;)subp.stdin.flush()#不要忘记了关闭subp，否则会阻塞subp.stdin.close()print(subp.stdout.read()) output1231.1.111.1.111.1.11 实时输入并输出结果需要用到多线程threading和队列queue来实时获取输出结果。最后也不要忘记调用子进程的close()方法。 example-2123456789101112131415161718192021import subprocessimport queueimport threading,timebash_path = r&#x27;F:\\Program Files\\Git\\bin\\bash.exe&#x27;def thread_for_listen(subp,q): for line in iter(subp.stdout.readline,&#x27;&#x27;): q.put(line)subp = subprocess.Popen(bash_path,stdin=subprocess.PIPE,stdout=subprocess.PIPE,stderr=subprocess.PIPE,encoding=&#x27;utf8&#x27;,cwd=&#x27;./public&#x27;)q = queue.Queue()p1 = threading.Thread(target =thread_for_listen,args=(subp,q))p1.start()for i in range(5): subp.stdin.write(&#x27;nvm -v\\n&#x27;) subp.stdin.flush() print(q.get(),end=&#x27;&#x27;) time.sleep(0.3) print(&#x27;wake up after 0.3s&#x27;)subp.stdin.close()q.task_done() output123456789101.1.11wake up after 0.3s1.1.11wake up after 0.3s1.1.11wake up after 0.3s1.1.11wake up after 0.3s1.1.11wake up after 0.3s","categories":[{"name":"python学习笔记","slug":"python学习笔记","permalink":"https://xingpingcn.top/categories/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"python","slug":"python","permalink":"https://xingpingcn.top/tags/python/"}]},{"title":"使用freecdn-js提高hexo博客的cdn稳定性","slug":"使用freecdn-js提高hexo博客的cdn稳定性","date":"2023-09-21T03:16:39.596Z","updated":"2023-10-01T17:53:09.749Z","comments":true,"path":"使用freecdn-js提高hexo博客的cdn稳定性.html","link":"","permalink":"https://xingpingcn.top/%E4%BD%BF%E7%94%A8freecdn-js%E6%8F%90%E9%AB%98hexo%E5%8D%9A%E5%AE%A2%E7%9A%84cdn%E7%A8%B3%E5%AE%9A%E6%80%A7.html","excerpt":"由于cdn.jsdelivr.net在国内不太稳定，替代的jsd.cdn.zzko.cn稳定性稍好，但是也不是100%稳定，因而需要一个脚本实时切换到合适的CDN。freecdn-js能实现这个需求，但是我的文件（图片、js等）储存在GitHub图床，而freecdn-js本身需要被加速的文件的hash，因此需要自己写脚本处理下载图片并计算。因为图片等文件的cdn链接是直接写在.md文件中的，所以写了一个正则脚本来提取cdn的链接。","text":"由于cdn.jsdelivr.net在国内不太稳定，替代的jsd.cdn.zzko.cn稳定性稍好，但是也不是100%稳定，因而需要一个脚本实时切换到合适的CDN。freecdn-js能实现这个需求，但是我的文件（图片、js等）储存在GitHub图床，而freecdn-js本身需要被加速的文件的hash，因此需要自己写脚本处理下载图片并计算。因为图片等文件的cdn链接是直接写在.md文件中的，所以写了一个正则脚本来提取cdn的链接。 脚本使用方法cdn链接处理脚本https://github.com/xingpingcn/picture-bed-use-freecdn 我写的脚本发布在GitHub上，匹配了![img](url)、&#123;%link%&#125;、&#123;%image%&#125;、headimg四个tag。脚本请到GitHub下载。 可以屏蔽相关cdn（更改host或用v2rayN路由屏蔽）测试freecdn-js是否能切换备用cdn。 扩展教程在这里 需要的包版本 package version123urllib3 1.25.11nodejs 16.10.0freecdn 0.3.1 以下引用GitHub上的README.md文件 (()=>{ volantis.css(\"https://unpkg.com/github-markdown-css@5.1.0/github-markdown.min.css\"); const contentEl = document.getElementById(\"md-81257ced-6962-ba52-8fff-58420a1ec9ad\"); const loadMarkdown = (url) => { if (!window.fetch) { contentEl.innerHTML = 'Your browser outdated. Please use the latest version of Chrome or Firefox!您的浏览器版本过低，请使用最新版的 Chrome 或 Firefox 浏览器！'; } else { contentEl.innerHTML = 'Loading ... | 加载中。。。'; fetch(url, { method: \"GET\" }) .then((resp) => { return Promise.all([ resp.ok, resp.status, resp.text(), resp.headers, ]); }) .then(([ok, status, data, headers]) => { if (ok) { return { ok, status, data, headers, }; } else { throw new Error(JSON.stringify(json.error)); } }) .then((resp) => { let data = marked.parse(resp.data); contentEl.innerHTML = data; }) .catch((error) => { console.log(error); contentEl.innerHTML = 'There was a problem loading the file!加载文件时出现问题！'; }); }; }; volantis.js(\"https://unpkg.com/marked@4.0.10/marked.min.js\").then(()=>{ loadMarkdown(\"https://jsd.cdn.zzko.cn/gh/xingpingcn/picture-bed-using-freecdn@main/README.md?t=\" + new Date().getTime()); }) })();","categories":[{"name":"hexo折腾","slug":"hexo折腾","permalink":"https://xingpingcn.top/categories/hexo%E6%8A%98%E8%85%BE/"}],"tags":[{"name":"volantis","slug":"volantis","permalink":"https://xingpingcn.top/tags/volantis/"}]},{"title":"v2ray+ws+tls太慢解决方法","slug":"v2raywstls太慢解决方法","date":"2023-05-25T09:41:15.519Z","updated":"2023-09-03T07:10:54.539Z","comments":true,"path":"v2raywstls太慢解决方法.html","link":"","permalink":"https://xingpingcn.top/v2raywstls%E5%A4%AA%E6%85%A2%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95.html","excerpt":"目前推荐hysteria，一个比较新的协议，gfw似乎还没有针对这个做出限制。我自己搭建梯子的话感觉kcp和ws+tls是比较快的，但是kcp容易被墙，而且掉包有点高，ws+tls需要用上cf的cdn加速才能快，而且要筛选速度快的cf的ip才能快（目前来看稳定性较差，建议用hysteria搭建梯子）。","text":"目前推荐hysteria，一个比较新的协议，gfw似乎还没有针对这个做出限制。我自己搭建梯子的话感觉kcp和ws+tls是比较快的，但是kcp容易被墙，而且掉包有点高，ws+tls需要用上cf的cdn加速才能快，而且要筛选速度快的cf的ip才能快（目前来看稳定性较差，建议用hysteria搭建梯子）。 先看优化结果 如果用hysteria在非晚高峰可以秒开4k60fps，晚高峰秒开1080p60fps。cf的cdn则看运气 如果用hysteria会时不时变卡，建议vps设置自动在凌晨重启 hysteria一键搭建https://github.com/emptysuns/Hi_Hysteria 下面是加了cdn的结果 cf-cdn优化后的速度（速度在一直增加，峰值跑到200m不是问题） 没有优化的话速度简直不能看。 前言推荐使用hysteria（区别于ws+tls+cdn，这个协议不能添加也不需要添加cdn）。 hysteria一键搭建https://github.com/emptysuns/Hi_Hysteria 如要添加cdn则需要：1、vps，我用的是免费的亚马逊云香港服务器ec2（2c1g）2、一个域名，可以到namesilo(点击购买域名)，.xyz域名只需要0.99刀一年，第二年重新换一个就可以。支持支付宝付费，还不用实名，送邮箱域名和隐私保护。3、cloudflare账号（没有的账号的，去谷歌搜索然后注册）4、cf ip自选工具点击查看5、 Easy install latest or LTS linux kernel and enable BBR or BBR plusBBR vs BBRplus vs BBR2 一般网络速度对比 默认已经搭建v2ray，没有搭建的可以查看这里 域名添加a记录到vps的ip因为我们要用到cloudflare的cdn，所以买到域名之后直接把nameserver（NS）改成cloudflare提供的NS。 需要在cloudflare账号中添加你的域名，cf会给你NS，然后到域名供应商的设置页面更换域名的NS。 cloudflare提供的NS 如果是在namesilo买的，更换NS的入口还比较隐蔽，点击看下图可以查看入口。 namesilo NS更换入口 之后自定义一个二级域名，例如forv2ray.example.com，添加A记录到你的vps ip。并且开启cdn（如出现下图代理状态的图标，则开启成功。或需要等一段时间才能生效） cloudflare添加A记录 之后把证书加密模式改成完全（full） 把证书加密模式改成完全（full） 这个时候可以ping一下你的二级域名，或者测一下v2ray的速度了，不过应该很慢。 证书的话我是脚本自动生成的，当然也可以到cf设置 -&gt; SSL&#x2F;TLS -&gt; 源服务器生成。 筛选适合的cloudflare ipip筛选工具https://github.com/XIU2/CloudflareSpeedTest 下载后打开运行，记得关掉你的梯子，然后将最快的ip填写到你的v2ray客户端的地址（addres）位置。 更改v2ray设置 其中的伪装域名填写你在cf添加A记录到vps IP的二级域名。 这个时候你就可以去测速了（或需要等待一段时间生效）","categories":[],"tags":[{"name":"v2ray","slug":"v2ray","permalink":"https://xingpingcn.top/tags/v2ray/"}]},{"title":"在GIT中忽略文件操作[转]","slug":"在GIT中忽略文件操作[转]","date":"2023-05-08T15:32:18.776Z","updated":"2023-05-08T15:38:36.136Z","comments":true,"path":"在GIT中忽略文件操作[转].html","link":"https://www.cnblogs.com/liuyuelinfighting/p/16206037.html","permalink":"https://xingpingcn.top/%E5%9C%A8GIT%E4%B8%AD%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C[%E8%BD%AC].html","excerpt":"","text":"","categories":[],"tags":[]},{"title":"为hexo博客添加自适应图片占位图（配合lazyload）","slug":"为hexo博客添加自适应图片占位图","date":"2023-05-06T08:10:46.753Z","updated":"2023-09-03T07:10:53.554Z","comments":true,"path":"为hexo博客添加自适应图片占位图.html","link":"","permalink":"https://xingpingcn.top/%E4%B8%BAhexo%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0%E8%87%AA%E9%80%82%E5%BA%94%E5%9B%BE%E7%89%87%E5%8D%A0%E4%BD%8D%E5%9B%BE.html","excerpt":"我们要得到的结果如封面所示 由于博客采用了图片懒加载（lazyload）插件，在加载dom后和图片加载成功之前，图片占位图为1px的像素，图片加载成功之后，则会把布局撑开，造成布局抖动。如果把和要加载的图片（本博客所有图片都放在了GitHub图床上，所以要用到image-size库访问远程图片）一样大小的占位图替代1px大小的占位图，则能解决布局抖动问题。本post将会占位图以硬编码的方式写到dom中，这需要修改在生成hexo博客时会用到的fancybox.js（或许每个主题用到的文件里都不一样，但最终都会使用hexo.extend.tag.register()方法；本博客使用volantis主题）。","text":"我们要得到的结果如封面所示 由于博客采用了图片懒加载（lazyload）插件，在加载dom后和图片加载成功之前，图片占位图为1px的像素，图片加载成功之后，则会把布局撑开，造成布局抖动。如果把和要加载的图片（本博客所有图片都放在了GitHub图床上，所以要用到image-size库访问远程图片）一样大小的占位图替代1px大小的占位图，则能解决布局抖动问题。本post将会占位图以硬编码的方式写到dom中，这需要修改在生成hexo博客时会用到的fancybox.js（或许每个主题用到的文件里都不一样，但最终都会使用hexo.extend.tag.register()方法；本博客使用volantis主题）。 为hexo博客添加自适应图片占位图 为图片添加占位图的基本结构以全宽图片为例： 123456789&lt;div style=&#x27;position: relative; width: 100%;&#x27;&gt; &lt;!-- padding-bottom设置占位图大小 --&gt; &lt;a style=&quot;position: relative; height: 0; padding-bottom: $&#123;h_divide_w_str&#125;;color:gray;background-color: rgb(204, 204, 204);&quot;&gt; &lt;!-- 占位图中的文字 --&gt; &lt;div style=&quot;position: absolute; left: 50%; top: 50%;transform: translate(-50%, -50%);&quot;&gt;loading picture...&lt;/div&gt; &lt;!-- 图片 --&gt; &lt;img&gt; &lt;/a&gt;&lt;/div&gt; 其中position、width、height、padding为必要属性，$&#123;h_divide_w_str&#125;为占位图的宽高比。因为需要解决布局抖动问题，所以占位图的宽高比要与图片一致，如何动态获取宽高比呢？这需要在生成hexo博客之前获取，然后代入到$&#123;h_divide_w_str&#125;中。 volantis主题动态获取远程图片的宽高比有些时候可能读取不了图片就出错，可以试多几次就没有问题，或者自己写一个失败重试的代码 在编写博客的时候用到了gallery标签插件，这个插件可以在点击图片的时候放大（这是由fancybox.js和fancybox.css驱动。注意：这里的fancybox.js是JavaScript文件，而生成hexo博客用到的同名文件是Nodejs文件） 我们需要修改的，就是生成html对应的文件，而生成gallery的文件位于blog\\node_modules\\hexo-theme-volantis\\scripts\\tags\\fancybox.js（nodejs文件）。 点击链接可以下载我修改好的fancybox.js fancybox.jshttps://github.com/xingpingcn/picx-images-hosting/blob/master/fancybox.js 以下是使用image-size库访问远程图片得到宽高比的代码示例。image-sizehttps://www.npmjs.com/package/image-size blog\\node_modules\\hexo-theme-volantis\\scripts\\tags\\fancybox.js12345678910111213141516171819const url = require(&#x27;url&#x27;)const http = require(&#x27;http&#x27;)const sizeOf = require(&#x27;image-size&#x27;)const imgUrl = &#x27;http://my-amazing-website.com/image.jpeg&#x27;const options = url.parse(imgUrl)http.get(options, function (response) &#123; const chunks = [] response.on(&#x27;data&#x27;, function (chunk) &#123; chunks.push(chunk) &#125;).on(&#x27;end&#x27;, function() &#123; const buffer = Buffer.concat(chunks) const dimensions = sizeOf(buffer); const h_divide_w = 100 * dimensions.height / dimensions.width; const h_divide_w_str = h_divide_w.toString() + &#x27;%&#x27;; //宽高比 &#125;)&#125;) 修改宽高比得到宽高比后自定义css样式，以下以volantis主题为例 blog\\node_modules\\hexo-theme-volantis\\scripts\\tags\\fancybox.js12345const result = `&lt;div class=&#x27;fancybox&#x27; style=&#x27;position: relative; width: 100%;&#x27;&gt; &lt;a class=&#x27;fancybox&#x27; pjax-fancybox itemscope itemtype=&quot;http://schema.org/ImageObject&quot; itemprop=&quot;url&quot; href=&#x27;$&#123;url&#125;&#x27; data-fancybox=&#x27;$&#123;group&#125;&#x27; data-caption=&#x27;$&#123;alt&#125;&#x27; style=&quot;position: relative;background-color: rgb(204, 204, 204);border-radius: 4px; padding-bottom: $&#123;h_divide_w_str&#125;;color:gray;&quot;&gt; &lt;div style=&quot;position: absolute; left: 50%; top: 50%;transform: translate(-50%, -50%);&quot;&gt;loading picture...&lt;/div&gt; $&#123;newItem&#125; &lt;/a&gt;$&#123;buidAlt(imageTags || alt)&#125;&lt;/div&gt;`; 此代码只是实例，不同主题的class和变量名称可能不一样 因为是获取图片宽高比异步进行的，所以要在hexo.extend.tag.register()方法中添加async: true以堵塞博客的生成，这样才能在得到宽高比后生成博客。此方法点击以下链接查看更多。 hexo标签插件（Tag）https://hexo.io/zh-cn/api/tag.html blog\\node_modules\\hexo-theme-volantis\\scripts\\tags\\fancybox.js1hexo.extend.tag.register(&#x27;gallery&#x27;, postFancybox, &#123; ends: true ,async: true&#125;); 其中postFancybox是返回值是promise类型。（点击以上的hexo标签插件（Tag）查看更多） 如果在一个gallery内有多个图片，或许需要用到for循环，那么需要promise.all()确保所有占位图生成完成后再生成网页。 修改fancybox.csshexo的css是用styl编写的，而volantis主题的fancybox.css位于blog\\node_modules\\hexo-theme-volantis\\source\\css\\_style\\_tag-plugins\\fancybox.styl。 点击链接查看更多 fancybox.stylhttps://github.com/xingpingcn/picx-images-hosting/blob/master/fancybox.styl 主要就是把影响自定义css的height属性删去（我大概也忘了修改过什么了，，，）。 添加动画 将html代码添加到fancybox.js对应位置就能得到以上效果 blog\\node_modules\\hexo-theme-volantis\\scripts\\tags\\fancybox.js1&lt;svg class=&quot;spinner0&quot; viewBox=&quot;0 0 50 50&quot;&gt; &lt;circle class=&quot;path0&quot; cx=&quot;25&quot; cy=&quot;25&quot; r=&quot;20&quot; fill=&quot;none&quot; stroke-width=&quot;4&quot;&gt;&lt;/circle&gt;&lt;/svg&gt; 然后修改css样式 blog\\node_modules\\hexo-theme-volantis\\source\\css\\_first\\base_first.styl123456789101112131415161718192021222324252627282930313233343536373839404142434445.spinner0 &#123; animation: rotate 2s linear infinite; position: absolute; top: 50%; left: 50%; margin: -25px 0 0 -25px; width: 50px; height: 50px; &amp; .path0 &#123; stroke: var(--color-list-hl); stroke-linecap: round; animation: dash 1.5s ease-in-out infinite; &#125; &#125;@keyframes rotate &#123; 100% &#123; transform: rotate(360deg); &#125;&#125;@keyframes dash &#123; 0% &#123; stroke-dasharray: 1, 150; stroke-dashoffset: 0; &#125; 50% &#123; stroke-dasharray: 90, 150; stroke-dashoffset: -35; &#125; 100% &#123; stroke-dasharray: 90, 150; stroke-dashoffset: -124; &#125;&#125;// 加载图片后暂停动画.spinner0:has(+ img.loaded)&#123; animation-play-state: paused; &gt; circle &#123; animation-play-state: paused; &#125; &#125;","categories":[{"name":"hexo折腾","slug":"hexo折腾","permalink":"https://xingpingcn.top/categories/hexo%E6%8A%98%E8%85%BE/"}],"tags":[{"name":"volantis","slug":"volantis","permalink":"https://xingpingcn.top/tags/volantis/"}]},{"title":"优化部署在github page的hexo-volantis的国内访问速度（dom、图片、js、css等）","slug":"为volantis添加cdn加速","date":"2023-04-21T08:35:18.593Z","updated":"2023-09-28T13:07:29.468Z","comments":true,"path":"为volantis添加cdn加速.html","link":"","permalink":"https://xingpingcn.top/%E4%B8%BAvolantis%E6%B7%BB%E5%8A%A0cdn%E5%8A%A0%E9%80%9F.html","excerpt":"国内直连访问自己的网站太慢了，发现官方推荐使用cdn加速，于是试了一下，也踩了一些坑，弄完之后确实快了许多","text":"国内直连访问自己的网站太慢了，发现官方推荐使用cdn加速，于是试了一下，也踩了一些坑，弄完之后确实快了许多 前言进阶的设置请看这篇：使用freecdn-js提高hexo博客的cdn稳定性 寻找访问慢的根源打开调试台-网络，查看原因 寻找访问慢的根源 可以看到，访问GitHub page、css文件和js文件都超过了1秒以上，加载图片更是慢的不得了，这几个问题都是要解决的。 使用netlify部署网页 netlify page访问速度 访问GitHub page很慢，使用使用netlify部署网页能加快访问速度，netlify支持从GitHub抓取repo并部署，也就是说hexo生成并上传网页到GitHub，netlify就能同步部署，而且速度还很快。netlify每个月有100g免费流量，把图片、js等静态资源放在GitHub，然后用cdn加速（下面会讲到），会节省不少流量。 可以从上图看到，netlify托管的网页国内访问速度非常快，比cf page（平均2+秒，较为稳定）和vercel（电信很慢，其他还行）好多了。看了一下，访问慢的似乎是因为刚刚换了netlify的dns，还有缓存所以域名解析到vercel了，所以慢的都是vercel()。 netlify可以免费给你分配一个二级域名，也可以换成自己买的域名（我没有备案速度也很快），真的很良心了。 域名我在namesilo(点击购买域名)买的，.top后缀续费4.8刀，和阿里云国际版价格差不多，国内版要便宜很多，不过要实名。当然namesilo这个价格比很多国外域名注册商便宜了。 .xyz只要0.99刀更加便宜。 使用jsd.cdn.zzko.cnjsd.cdn.zzko.cn替代cdn.jsdelivr.net进行cdn加速css和js主题默认配置用的cdn.jsdelivr.net现在似乎不会突然抽筋了，但是依然很慢，jsd.cdn.zzko.cn是一个免费面向中国境内外的高速jsdelivr镜像站，访问速度很快，可以作为理想的替代方案。 备用域名cdn.jsdelivr.ren、gcore.jsdelivr.net 等 现在jsd.cdn.zzko.cn应该是修复了，所以不需要改了。直接在配置中添加一下代码即可。 如果仔细观察上面的图，可以发现访问的`style.css`变成了`style.xxxx.css`，同理`app.js`。这个是hexo在生成`public`文件夹的时候生成的，而怎么样不让他改为这种类型的名字，我不知道怎么样做。出于保险，我用了一个替代的方案，把`blog\\public\\css\\style.xxxx.css`复制出来，并重命名为`style.css`，同理`app.js`。（这个是因为设置了`cdn_version: true`） 由于访问`jsd.cdn.zzko.cn`的响应头（response）中没有指定`content-type: charset=utf-8`，因而浏览器在解析的时候会出错。这时需要在`style.css`手动添加代码 如果在配置文件中修改了`css`布局，如`sidebar`从左边移到了右边，则需要重新添加代码并上传至GitHub，因而推荐弄好布局后再上传 1@charset &quot;UTF-8&quot;; 需要在第一行顶格填写 这时我们有了能正常访问的css文件（js不需要改） 之后需要cdn加速css和js文件，直接把css和js文件放在blog\\source下，上传网页的时候hexo会把这些一起上传到根目录/。 或者在GitHub新开一个不同于个人GitHub page的repo，之后在根目录/上传这两个改了名字后的css和js文件。 使用 1https://jsd.cdn.zzko.cn/gh/user/repo/style.css 就能访问style.css了，同理app.js。 要让volantis访问cdn加速链接，需要在配置中添加一下代码。 _config.volantis.yml123456789101112cdn: enable: true set: js: app: https://jsd.cdn.zzko.cn/gh/user/repo/app.js css: style: https://jsd.cdn.zzko.cn/gh/user/repo/style.css # (异步加载样式)cdn_version: falsevolantis_static_cdn: https://jsd.cdn.zzko.cn/npm/volantis-static@0.0.1654736714924/ user和repo都改为自己的。如果没有刷新没有变化记得设置cdn_version: false然后重启服务器。 volantis_static_cdn的值或许需要根据默认配置中的静态文件版本去更改，也就是@后面的一串数字。 使用PicX图床工具 使用方便管理的图床让你编辑文章更加得心应手，此图床可以自动压缩图片，添加md格式等，配置也十分简单，直接看官方文档就ok。 其图床还有多种cdn加速可选，十分方便。 PicX图床工具官方文档https://picx-docs.xpoet.cn 结语最后看看访问速度 访问速度快 shift+F5强制刷新，速度还挺满意，dom打开速度很快了，只是没更新图片（），，懒，可以直接试试测我的网站速度看看。","categories":[{"name":"hexo折腾","slug":"hexo折腾","permalink":"https://xingpingcn.top/categories/hexo%E6%8A%98%E8%85%BE/"}],"tags":[{"name":"volantis","slug":"volantis","permalink":"https://xingpingcn.top/tags/volantis/"}]},{"title":"使用volantis中遇到的坑","slug":"hexo折腾","date":"2023-04-20T15:00:16.000Z","updated":"2023-09-03T07:10:57.098Z","comments":true,"path":"hexo折腾.html","link":"","permalink":"https://xingpingcn.top/hexo%E6%8A%98%E8%85%BE.html","excerpt":"使用volantis中遇到几个坑，如volantis404页面不生效，sidebar效果不生效，如何更改图片尺寸，手机模式下toc会被遮挡等，这里做了笔记","text":"使用volantis中遇到几个坑，如volantis404页面不生效，sidebar效果不生效，如何更改图片尺寸，手机模式下toc会被遮挡等，这里做了笔记 写在前面更改配置的时候记得刷新页面，如果不生效，记得重启本地服务器！ 更改配置的时候记得刷新页面，如果不生效，记得重启本地服务器！ 更改配置的时候记得刷新页面，如果不生效，记得重启本地服务器！ 404页面不生效按照官方的文档配置404页面，在本地打开一个不存在的页面，并不显示404页面，重启服务器依然不行。干脆直接放到GitHub page上，结果404页面能生效 结论：如果本地404页面不生效，就上传到服务器端查看是否生效 sidebar效果不生效我的volantis版本是volantis5.7，主题文件设置中的sidebar的shadow, floatable, blur效果不生效 _config.volantis.yml12sidebar: effect: [shadow, floatable, blur] 我的方法是打开blog\\node_modules\\hexo-theme-volantis\\layout\\_widget，这里存放着sidebar的各个组件。 以下以修改blogger组件为例： 找到代码 blog\\node_modules\\hexo-theme-volantis\\layout\\_widget\\blogger.ejs1&lt;section class=&quot;widget &lt;%- item.class %&gt; &lt;%- page.widget_platform %&gt; &lt;%- page.widget_pjax %&gt;&quot;&gt; 可以看到class中是没有shadow, floatable, blur的，只需要我们手动添加关键词就能生效 blog\\node_modules\\hexo-theme-volantis\\layout\\_widget\\blogger.ejs1&lt;section class=&quot;widget blur floatable shadow &lt;%- item.class %&gt; &lt;%- page.widget_platform %&gt; &lt;%- page.widget_pjax %&gt;&quot;&gt; 刷新就可以看到效果生效，左边的blogger组件有高斯模糊并且有阴影效果了。 效果 其他组件也是同样的方法，关键是要找到这行代码 blog\\node_modules\\hexo-theme-volantis\\layout\\_widget\\xxx.ejs1&lt;section class=&quot;widget ...&quot;&gt; 这行代码可以在浏览器打开元素查看器找到 按F12可以打开元素查看器 效果 更改图片显示尺寸和圆角半径图片显示尺寸使用以下代码，则能显示如本post中的图片一样的效果 &#123;% image https://cdn.jsdelivr.net/gh/xingpingcn/picx-images-hosting@master/20230420/image.2v43xxro3vs0.png::width=80%::alt=效果 %&#125; 其中的url，width和alt可以自己修改。width的单位可以是px也可以是百分比% 图片圆角半径打开\\img.styl就可以修改圆角半径 blog\\node_modules\\hexo-theme-volantis\\source\\css\\_style\\_layout\\img.styl12345678910111213141516.md img position: relative trans() @media screen and (max-width: $device-mobile) box-shadow: none div&gt;img,p&gt;img,a&gt;img display: block margin: auto border-radius: 4px @media screen and (max-width: $device-mobile) border-radius: 4px span img display: inline margin: auto 其中的border-radius就是半径的key（默认的配置文件中应该有3个，我没有复制全），修改你想要的value。 如果在像我一样在第7行行尾添加a&gt;img，则可以修改使用gallery标签插件的图片中border-radius的值。 解决手机模式下toc会被遮挡的问题 toc被遮挡 解决后 只需要在\\navbar_first.styl中修改z-index值为一个较小的数字。 blog\\node_modules\\hexo-theme-volantis\\source\\css\\_first12345.l_header $iconW = 36px $iconMargin = 4px position: fixed z-index: 10","categories":[{"name":"hexo折腾","slug":"hexo折腾","permalink":"https://xingpingcn.top/categories/hexo%E6%8A%98%E8%85%BE/"}],"tags":[{"name":"volantis","slug":"volantis","permalink":"https://xingpingcn.top/tags/volantis/"}]},{"title":"test","slug":"test4","date":"2023-04-19T16:51:16.000Z","updated":"2023-09-03T07:10:58.596Z","comments":true,"path":"test4.html","link":"","permalink":"https://xingpingcn.top/test4.html","excerpt":"a cat","text":"a cat a cat删除线 臭卷宝hh More info: bilibi 123222 2311 info about a cat 视频 轮转（科学上网）","categories":[],"tags":[{"name":"test","slug":"test","permalink":"https://xingpingcn.top/tags/test/"}]},{"title":"Hello World","slug":"hello-world","date":"2023-04-18T08:09:30.189Z","updated":"2023-04-22T18:34:01.035Z","comments":true,"path":"hello-world.html","link":"","permalink":"https://xingpingcn.top/hello-world.html","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[{"name":"test","slug":"test","permalink":"https://xingpingcn.top/tags/test/"}]}],"categories":[{"name":"hexo折腾","slug":"hexo折腾","permalink":"https://xingpingcn.top/categories/hexo%E6%8A%98%E8%85%BE/"},{"name":"python学习笔记","slug":"python学习笔记","permalink":"https://xingpingcn.top/categories/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"npm","slug":"npm","permalink":"https://xingpingcn.top/tags/npm/"},{"name":"python","slug":"python","permalink":"https://xingpingcn.top/tags/python/"},{"name":"volantis","slug":"volantis","permalink":"https://xingpingcn.top/tags/volantis/"},{"name":"v2ray","slug":"v2ray","permalink":"https://xingpingcn.top/tags/v2ray/"},{"name":"test","slug":"test","permalink":"https://xingpingcn.top/tags/test/"}]}